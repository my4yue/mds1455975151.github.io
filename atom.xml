<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>DongSheng&#39;s Blog</title>
  <icon>https://www.gravatar.com/avatar/2e394ffb56f8f004acd7419b61a7c933</icon>
  <subtitle>记录点滴，不断突破</subtitle>
  <link href="/atom.xml" rel="self"/>
  
  <link href="https://mds1455975151.github.io/"/>
  <updated>2018-08-06T06:42:06.677Z</updated>
  <id>https://mds1455975151.github.io/</id>
  
  <author>
    <name>DongSheng</name>
    <email>madscdpc@gmail.com</email>
  </author>
  
  <generator uri="http://hexo.io/">Hexo</generator>
  
  <entry>
    <title>基于Consul+upsync构建动态Nginx配置系统</title>
    <link href="https://mds1455975151.github.io/archives/c92739f9.html"/>
    <id>https://mds1455975151.github.io/archives/c92739f9.html</id>
    <published>2018-08-06T03:29:49.000Z</published>
    <updated>2018-08-06T06:42:06.677Z</updated>
    
    <content type="html"><![CDATA[<script src="\assets\js\APlayer.min.js"> </script><blockquote><p>基于Consul+upsync构建动态Nginx配置系统</p></blockquote><a id="more"></a><h1 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h1><p>本文介绍如何利用Consul+upsync来实现动态的管理Nginx后端服务器，实现动态增删后端服务器而无需reload Nginx服务。</p><h1 id="环境说明"><a href="#环境说明" class="headerlink" title="环境说明"></a>环境说明</h1><table><thead><tr><th>IP</th><th>os</th><th>role</th><th>remark</th></tr></thead><tbody><tr><td>192.168.200.101</td><td>CentOS 7.4</td><td>nginx-lb and consul</td><td></td></tr><tr><td>192.168.200.102</td><td>CentOS 7.4</td><td>nginx-server</td><td></td></tr><tr><td>192.168.200.103</td><td>CentOS 7.4</td><td>nginx-server</td></tr></tbody></table><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"># cat /etc/redhat-release</span><br><span class="line">CentOS Linux release 7.2.1511 (Core)</span><br><span class="line"># uname -r</span><br><span class="line">3.10.0-327.el7.x86_64</span><br><span class="line"># uname -m</span><br><span class="line">x86_64</span><br><span class="line"># nginx -V</span><br><span class="line">nginx version: nginx/1.14.0</span><br><span class="line">built by gcc 4.8.5 20150623 (Red Hat 4.8.5-28) (GCC)</span><br><span class="line">built with OpenSSL 1.0.2k-fips  26 Jan 2017</span><br><span class="line">TLS SNI support enabled</span><br><span class="line">configure arguments: --prefix=/etc/nginx --sbin-path=/usr/sbin/nginx --modules-path=/usr/lib64/nginx/modules --conf-path=/etc/nginx/nginx.conf --error-log-path=/var/log/nginx/error.log --http-log-path=/var/log/nginx/access.log --pid-path=/var/run/nginx.pid --lock-path=/var/run/nginx.lock --http-client-body-temp-path=/var/cache/nginx/client_temp --http-proxy-temp-path=/var/cache/nginx/proxy_temp --http-fastcgi-temp-path=/var/cache/nginx/fastcgi_temp --http-uwsgi-temp-path=/var/cache/nginx/uwsgi_temp --http-scgi-temp-path=/var/cache/nginx/scgi_temp --user=nginx --group=nginx --with-compat --with-file-aio --with-threads --with-http_addition_module --with-http_auth_request_module --with-http_dav_module --with-http_flv_module --with-http_gunzip_module --with-http_gzip_static_module --with-http_mp4_module --with-http_random_index_module --with-http_realip_module --with-http_secure_link_module --with-http_slice_module --with-http_ssl_module --with-http_stub_status_module --with-http_sub_module --with-http_v2_module --with-mail --with-mail_ssl_module --with-stream --with-stream_realip_module --with-stream_ssl_module --with-stream_ssl_preread_module --with-cc-opt=&apos;-O2 -g -pipe -Wall -Wp,-D_FORTIFY_SOURCE=2 -fexceptions -fstack-protector-strong --param=ssp-buffer-size=4 -grecord-gcc-switches -m64 -mtune=generic -fPIC&apos; --with-ld-opt=&apos;-Wl,-z,relro -Wl,-z,now -pie&apos; --add-module=/data0/src/nginx_upstream_check_module --add-module=/data0/src/nginx-upsync-module</span><br><span class="line"># consul version</span><br><span class="line">Consul v1.2.2</span><br><span class="line">Protocol 2 spoken by default, understands 2 to 3 (agent will automatically use protocol &gt;2 when speaking to compatible agents)</span><br></pre></td></tr></table></figure><h1 id="Nginx-Server安装"><a href="#Nginx-Server安装" class="headerlink" title="Nginx-Server安装"></a>Nginx-Server安装</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"># yum install -y pcre-devel openssl-devel</span><br><span class="line"># cat /etc/yum.repos.d/nginx.repo</span><br><span class="line">[nginx]</span><br><span class="line">name=nginx repo</span><br><span class="line">baseurl=http://nginx.org/packages/centos/7/$basearch/</span><br><span class="line">gpgcheck=0</span><br><span class="line">enabled=1</span><br><span class="line"># yum install -y nginx</span><br><span class="line"># systemctl start nginx</span><br><span class="line"># systemctl enable nginx</span><br><span class="line"># echo &quot;linux-node03.example.com:192.168.47.102&quot; &gt;/usr/share/nginx/html/index.html</span><br><span class="line"># echo &quot;linux-node04.example.com:192.168.47.103&quot; &gt;/usr/share/nginx/html/index.html</span><br></pre></td></tr></table></figure><h1 id="Nginx-LB配置"><a href="#Nginx-LB配置" class="headerlink" title="Nginx-LB配置"></a>Nginx-LB配置</h1><h2 id="Nginx部署"><a href="#Nginx部署" class="headerlink" title="Nginx部署"></a>Nginx部署</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"># yum install -y pcre-devel openssl-devel</span><br><span class="line"># cat /etc/yum.repos.d/nginx.repo</span><br><span class="line">[nginx]</span><br><span class="line">name=nginx repo</span><br><span class="line">baseurl=http://nginx.org/packages/centos/7/$basearch/</span><br><span class="line">gpgcheck=0</span><br><span class="line">enabled=1</span><br><span class="line"># yum install -y nginx</span><br><span class="line"># systemctl start nginx</span><br><span class="line"># systemctl enable nginx</span><br></pre></td></tr></table></figure><h2 id="nginx-upsync-module及nginx-upstream-check-module模块配置"><a href="#nginx-upsync-module及nginx-upstream-check-module模块配置" class="headerlink" title="nginx-upsync-module及nginx_upstream_check_module模块配置"></a>nginx-upsync-module及nginx_upstream_check_module模块配置</h2><p>upsync是微博开源的基于nginx的动态流量管理方案. github地址: <a href="https://github.com/weibocom/nginx-upsync-module" target="_blank" rel="noopener">https://github.com/weibocom/nginx-upsync-module</a>.</p><p>nginx-upsync-module，它的功能是拉取consul的后端server的列表，并更新Nginx的路由信息。此模块不依赖于任何第三方模块。 consul作为Nginx的db，利用consul的KV服务，每个Nginx work进程独立的去拉取各个upstream 的配置，并更新各自的路由。<br><img src="/archives/c92739f9/list_update.bmp" alt=""></p><p>模块相关信息可以参考GitHub文档信息：<a href="https://github.com/weibocom/nginx-upsync-module/tree/master/doc" target="_blank" rel="noopener">https://github.com/weibocom/nginx-upsync-module/tree/master/doc</a></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">cd /data0/src</span><br><span class="line">git clone https://github.com/weibocom/nginx-upsync-module.git</span><br><span class="line">git clone https://github.com/xiaokai-wang/nginx_upstream_check_module.git</span><br><span class="line">wget http://nginx.org/download/nginx-1.14.0.tar.gz</span><br><span class="line">tar -zxf nginx-1.14.0.tar.gz</span><br><span class="line">cd nginx-1.14.0</span><br><span class="line">patch -p1 &lt; /data0/src/nginx_upstream_check_module/check_1.12.1+.patch</span><br><span class="line">./configure --prefix=/etc/nginx --sbin-path=/usr/sbin/nginx --modules-path=/usr/lib64/nginx/modules --conf-path=/etc/nginx/nginx.conf --error-log-path=/var/log/nginx/error.log --http-log-path=/var/log/nginx/access.log --pid-path=/var/run/nginx.pid --lock-path=/var/run/nginx.lock --http-client-body-temp-path=/var/cache/nginx/client_temp --http-proxy-temp-path=/var/cache/nginx/proxy_temp --http-fastcgi-temp-path=/var/cache/nginx/fastcgi_temp --http-uwsgi-temp-path=/var/cache/nginx/uwsgi_temp --http-scgi-temp-path=/var/cache/nginx/scgi_temp --user=nginx --group=nginx --with-compat --with-file-aio --with-threads --with-http_addition_module --with-http_auth_request_module --with-http_dav_module --with-http_flv_module --with-http_gunzip_module --with-http_gzip_static_module --with-http_mp4_module --with-http_random_index_module --with-http_realip_module --with-http_secure_link_module --with-http_slice_module --with-http_ssl_module --with-http_stub_status_module --with-http_sub_module --with-http_v2_module --with-mail --with-mail_ssl_module --with-stream --with-stream_realip_module --with-stream_ssl_module --with-stream_ssl_preread_module --with-cc-opt=&apos;-O2 -g -pipe -Wall -Wp,-D_FORTIFY_SOURCE=2 -fexceptions -fstack-protector-strong --param=ssp-buffer-size=4 -grecord-gcc-switches -m64 -mtune=generic -fPIC&apos; --with-ld-opt=&apos;-Wl,-z,relro -Wl,-z,now -pie&apos; --add-module=/data0/src/nginx_upstream_check_module --add-module=/data0/src/nginx-upsync-module</span><br><span class="line">make</span><br><span class="line">which nginx</span><br><span class="line">cp /usr/sbin/nginx&#123;,.20180804&#125;</span><br><span class="line">systemctl stop nginx</span><br><span class="line">cp /data0/src/nginx-1.14.0/objs/nginx /usr/sbin/</span><br><span class="line">systemctl start ngin</span><br><span class="line">nginx -V</span><br></pre></td></tr></table></figure><h1 id="Consul配置"><a href="#Consul配置" class="headerlink" title="Consul配置"></a>Consul配置</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">cd /data0/src/</span><br><span class="line">wget https://releases.hashicorp.com/consul/1.2.2/consul_1.2.2_linux_amd64.zip</span><br><span class="line">unzip /data0/src/consul_1.2.2_linux_amd64.zip</span><br><span class="line">install /data0/src/consul /usr/local/bin/</span><br><span class="line">mkdir -p /data0/consul/&#123;data,logs&#125;</span><br><span class="line">consul agent --server --bind=192.168.200.101 --data-dir=/data0/consule/data -bootstrap-expect=1 -node=nginx-lb -client 0.0.0.0 -ui</span><br></pre></td></tr></table></figure><h1 id="调整Nginx配置并测试"><a href="#调整Nginx配置并测试" class="headerlink" title="调整Nginx配置并测试"></a>调整Nginx配置并测试</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br></pre></td><td class="code"><pre><span class="line"># cat /etc/nginx/nginx.conf</span><br><span class="line"></span><br><span class="line">user  nginx;</span><br><span class="line">worker_processes  1;</span><br><span class="line"></span><br><span class="line">error_log  /var/log/nginx/error.log warn;</span><br><span class="line">pid        /var/run/nginx.pid;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">events &#123;</span><br><span class="line">    worker_connections  1024;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">http &#123;</span><br><span class="line">    include       /etc/nginx/mime.types;</span><br><span class="line">    default_type  application/octet-stream;</span><br><span class="line"></span><br><span class="line">    log_format  main  &apos;$remote_addr - $remote_user [$time_local] &quot;$request&quot; &apos;</span><br><span class="line">                      &apos;$status $body_bytes_sent &quot;$http_referer&quot; &apos;</span><br><span class="line">                      &apos;&quot;$http_user_agent&quot; &quot;$http_x_forwarded_for&quot;&apos;;</span><br><span class="line"></span><br><span class="line">    access_log  /var/log/nginx/access.log  main;</span><br><span class="line"></span><br><span class="line">    sendfile        on;</span><br><span class="line">    #tcp_nopush     on;</span><br><span class="line"></span><br><span class="line">    keepalive_timeout  65;</span><br><span class="line"></span><br><span class="line">    #gzip  on;</span><br><span class="line"></span><br><span class="line">    include /etc/nginx/conf.d/*.conf;</span><br><span class="line"></span><br><span class="line">    upstream test &#123;</span><br><span class="line">        server 127.0.0.1:11111;</span><br><span class="line">        upsync 192.168.200.101:8500/v1/kv/upstreams/test upsync_timeout=6m upsync_interval=500ms upsync_type=consul strong_dependency=off;</span><br><span class="line">        upsync_dump_path /etc/nginx/server/server.conf;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    upstream bar &#123;</span><br><span class="line">        server 192.168.200.102:80 weight=1 fail_timeout=10 max_fails=3;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    server &#123;</span><br><span class="line">        listen 80;</span><br><span class="line"></span><br><span class="line">        location = / &#123;</span><br><span class="line">        proxy_pass http://test;</span><br><span class="line">          proxy_set_header  Host  $host;</span><br><span class="line">          proxy_set_header  X-Real-IP  $remote_addr;</span><br><span class="line">          proxy_set_header  X-Forwarded-For  $proxy_add_x_forwarded_for;</span><br><span class="line">          add_header    real $upstream_addr;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        location ~ /Content|Scripts/ &#123;</span><br><span class="line">          proxy_pass http://test;</span><br><span class="line">          proxy_set_header  Host  $host;</span><br><span class="line">          proxy_set_header  X-Real-IP  $remote_addr;</span><br><span class="line">          proxy_set_header  X-Forwarded-For  $proxy_add_x_forwarded_for;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        location = /bar &#123;</span><br><span class="line">            proxy_pass http://bar;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        location = /upstream_show &#123;</span><br><span class="line">            upstream_show;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        location = /upstream_status &#123;</span><br><span class="line">            stub_status on;</span><br><span class="line">            access_log off;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>创建upsync_dump_path<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mkdir -p /etc/nginx/server/</span><br></pre></td></tr></table></figure></p><h2 id="添加后端"><a href="#添加后端" class="headerlink" title="添加后端"></a>添加后端</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">curl -X PUT http://192.168.200.101:8500/v1/kv/upstreams/test/192.168.200.102:80</span><br><span class="line">curl -X PUT http://192.168.200.101:8500/v1/kv/upstreams/test/192.168.200.103:80</span><br></pre></td></tr></table></figure><h2 id="查看通过consul添加的后端服务器信息"><a href="#查看通过consul添加的后端服务器信息" class="headerlink" title="查看通过consul添加的后端服务器信息"></a>查看通过consul添加的后端服务器信息</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"># cat /etc/nginx/server/server.conf</span><br><span class="line">server 192.168.200.103:80 weight=1 max_fails=2 fail_timeout=10s;</span><br><span class="line">server 192.168.200.102:80 weight=1 max_fails=2 fail_timeout=10s;</span><br></pre></td></tr></table></figure><p><img src="/archives/c92739f9/03.png" alt=""></p><h2 id="验证nginx代理信息"><a href="#验证nginx代理信息" class="headerlink" title="验证nginx代理信息"></a>验证nginx代理信息</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"># for i in `seq 100` ;do curl -s -I http://192.168.200.101|tail -2|head -1;done</span><br><span class="line">real: 192.168.200.102:80</span><br><span class="line">real: 192.168.200.103:80</span><br><span class="line">real: 192.168.200.102:80</span><br><span class="line">real: 192.168.200.103:80</span><br><span class="line">real: 192.168.200.102:80</span><br><span class="line">real: 192.168.200.103:80</span><br><span class="line">real: 192.168.200.102:80</span><br><span class="line">real: 192.168.200.103:80</span><br><span class="line">real: 192.168.200.102:80</span><br><span class="line">real: 192.168.200.103:80</span><br><span class="line">real: 192.168.200.102:80</span><br><span class="line">real: 192.168.200.103:80</span><br></pre></td></tr></table></figure><blockquote><p>real地址就是后端服务器的地址</p></blockquote><h2 id="删除后端"><a href="#删除后端" class="headerlink" title="删除后端"></a>删除后端</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">curl -X DELETE http://192.168.200.101:8500/v1/kv/upstreams/test/192.168.200.102:80</span><br><span class="line">curl -X DELETE http://192.168.200.101:8500/v1/kv/upstreams/test/192.168.200.103:80</span><br></pre></td></tr></table></figure><h1 id="测试并验证"><a href="#测试并验证" class="headerlink" title="测试并验证"></a>测试并验证</h1><p><img src="/archives/c92739f9/01.png" alt=""><br><img src="/archives/c92739f9/02.png" alt=""></p><p>======================================================<br>希望各位朋友支持一下</p><ul><li>领取我的<a href="https://promotion.aliyun.com/ntms/act/ambassador/sharetouser.html?userCode=xpdsz87p&amp;utm_source=xpdsz87p" target="_blank" rel="noopener">阿里云幸运券</a>,谢谢.</li><li>使用<a href="https://cloud.tencent.com/redirect.php?redirect=1005&amp;cps_key=5a162632de40024cd01aabff4d3f1370" target="_blank" rel="noopener">腾讯云资源</a></li><li>自己的网站承接广告<a href="http://www.sudianlm.com/track/c/?rid=2056" target="_blank" rel="noopener">速点广告联盟</a></li><li>广告位招商QQ:1455975151</li><li>喜欢购物的朋友可以看看，<a href="http://www.1zhe.com/yq/1066027" target="_blank" rel="noopener">一折特卖</a><!--注册一折特卖，免费领集分宝，集分宝可以当钱花，免费购物不是梦，注册马上送你10集分宝。--></li></ul><p><strong>本文作者</strong>：dongsheng<br><strong>本文地址</strong>： <a href="https://mds1455975151.github.io/archives/c92739f9.html">https://mds1455975151.github.io/archives/c92739f9.html</a> <br><strong>版权声明</strong>：转载请注明出处！</p>]]></content>
    
    <summary type="html">
    
      基于consul+upsync构建动态Nginx配置系统
    
    </summary>
    
      <category term="DevOps" scheme="https://mds1455975151.github.io/categories/DevOps/"/>
    
    
      <category term="nginx" scheme="https://mds1455975151.github.io/tags/nginx/"/>
    
      <category term="upsync" scheme="https://mds1455975151.github.io/tags/upsync/"/>
    
      <category term="consul" scheme="https://mds1455975151.github.io/tags/consul/"/>
    
  </entry>
  
  <entry>
    <title>Jenkins之配置多jobs执行</title>
    <link href="https://mds1455975151.github.io/archives/de5dd2ef.html"/>
    <id>https://mds1455975151.github.io/archives/de5dd2ef.html</id>
    <published>2018-07-07T04:03:15.000Z</published>
    <updated>2018-07-07T05:57:49.967Z</updated>
    
    <content type="html"><![CDATA[<script src="\assets\js\APlayer.min.js"> </script><blockquote><p>Jenkins之配置多jobs执行</p></blockquote><a id="more"></a><h1 id="概述"><a href="#概述" class="headerlink" title="概述"></a>概述</h1><p>使用jenkins中，当有多个jobs需要互相关联时，就需要设置jobs的上下游关联关系。比如job_A运行后触发job_B。</p><h1 id="多jobs无关联参数"><a href="#多jobs无关联参数" class="headerlink" title="多jobs无关联参数"></a>多jobs无关联参数</h1><p>主要是上游配置及下游配置</p><h1 id="多jobs有关联参数"><a href="#多jobs有关联参数" class="headerlink" title="多jobs有关联参数"></a>多jobs有关联参数</h1><p>插件：Parameterized Trigger Plugin</p><p>场景：游戏打包及更新<br>打包项目：选择分支进行打包<br>更新项目：选择分支，选择包进行更新<br>即可以通过job关联起来，将打包的包名及分支名称传递给更新项目，简化及加快更新速度。</p><h1 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h1><h1 id="参考资料"><a href="#参考资料" class="headerlink" title="参考资料"></a>参考资料</h1><p>======================================================<br>希望各位朋友支持一下</p><ul><li>领取我的<a href="https://promotion.aliyun.com/ntms/act/ambassador/sharetouser.html?userCode=xpdsz87p&amp;utm_source=xpdsz87p" target="_blank" rel="noopener">阿里云幸运券</a>,谢谢.</li><li>使用<a href="https://cloud.tencent.com/redirect.php?redirect=1005&amp;cps_key=5a162632de40024cd01aabff4d3f1370" target="_blank" rel="noopener">腾讯云资源</a></li><li>自己的网站承接广告<a href="http://www.sudianlm.com/track/c/?rid=2056" target="_blank" rel="noopener">速点广告联盟</a></li><li>广告位招商QQ:1455975151</li><li>喜欢购物的朋友可以看看，<a href="http://www.1zhe.com/yq/1066027" target="_blank" rel="noopener">一折特卖</a><!--注册一折特卖，免费领集分宝，集分宝可以当钱花，免费购物不是梦，注册马上送你10集分宝。--></li></ul><p><strong>本文作者</strong>：dongsheng<br><strong>本文地址</strong>： <a href="https://mds1455975151.github.io/archives/de5dd2ef.html">https://mds1455975151.github.io/archives/de5dd2ef.html</a> <br><strong>版权声明</strong>：转载请注明出处！</p>]]></content>
    
    <summary type="html">
    
      Jenkins之配置多jobs执行
    
    </summary>
    
      <category term="jenkins" scheme="https://mds1455975151.github.io/categories/jenkins/"/>
    
    
      <category term="jenkins" scheme="https://mds1455975151.github.io/tags/jenkins/"/>
    
      <category term="多jobs" scheme="https://mds1455975151.github.io/tags/%E5%A4%9Ajobs/"/>
    
      <category term="并行" scheme="https://mds1455975151.github.io/tags/%E5%B9%B6%E8%A1%8C/"/>
    
      <category term="串行" scheme="https://mds1455975151.github.io/tags/%E4%B8%B2%E8%A1%8C/"/>
    
  </entry>
  
  <entry>
    <title>Git之镜像仓库全攻略</title>
    <link href="https://mds1455975151.github.io/archives/177a4e8b.html"/>
    <id>https://mds1455975151.github.io/archives/177a4e8b.html</id>
    <published>2018-07-07T04:01:41.000Z</published>
    <updated>2018-07-07T09:45:04.426Z</updated>
    
    <content type="html"><![CDATA[<script src="\assets\js\APlayer.min.js"> </script><blockquote><p>Git镜像仓库应用全攻略指南</p></blockquote><a id="more"></a><h1 id="概述"><a href="#概述" class="headerlink" title="概述"></a>概述</h1><p>以下案例以GitHub上的仓库作为原仓库，在国内或者公司局域网部署镜像仓库。使用<a href="https://github.com/mds1455975151/ansible-role-pip.git仓库作为原仓库。" target="_blank" rel="noopener">https://github.com/mds1455975151/ansible-role-pip.git仓库作为原仓库。</a></p><h2 id="应用场景"><a href="#应用场景" class="headerlink" title="应用场景"></a>应用场景</h2><ul><li>加速访问GitHub仓库</li><li>GitHub负载均衡(类似MySQL的读写分离架构)</li></ul><h1 id="原生git-clone-–mirror实现"><a href="#原生git-clone-–mirror实现" class="headerlink" title="原生git clone –mirror实现"></a>原生git clone –mirror实现</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"># cd /opt/</span><br><span class="line"># git clone --mirror https://github.com/mds1455975151/ansible-role-pip.git</span><br><span class="line"># ls -al</span><br><span class="line">total 16</span><br><span class="line">drwxr-xr-x.  4 root root 4096 Jul  7 13:31 .</span><br><span class="line">dr-xr-xr-x. 20 root root 4096 Jul  7 13:33 ..</span><br><span class="line">drwxr-xr-x   7 root root 4096 Jul  7 13:31 ansible-role-pip.git</span><br><span class="line">drwxr-xr-x.  2 root root 4096 Mar 26  2015 rh</span><br><span class="line"># git clone 10.135.95.147:/opt/ansible-role-pip.git .</span><br><span class="line">Cloning into &apos;.&apos;...</span><br><span class="line">remote: Counting objects: 181, done.</span><br><span class="line">remote: Compressing objects: 100% (77/77), done.</span><br><span class="line">remote: Total 181 (delta 75), reused 181 (delta 75)</span><br><span class="line">Receiving objects: 100% (181/181), 18.78 KiB | 0 bytes/s, done.</span><br><span class="line">Resolving deltas: 100% (75/75), done.</span><br><span class="line">[root@VM_95_147_centos tmp]# ll</span><br><span class="line">total 36</span><br><span class="line">drwxr-xr-x 2 root root 4096 Jul  7 13:35 defaults</span><br><span class="line">drwxr-xr-x 2 root root 4096 Jul  7 13:35 handlers</span><br><span class="line">drwxr-xr-x 2 root root 4096 Jul  7 13:35 meta</span><br><span class="line">-rw-r--r-- 1 root root 1233 Jul  7 13:35 README.md</span><br><span class="line">-rw-r--r-- 1 root root   28 Jul  7 13:35 requirements.yml</span><br><span class="line">drwxr-xr-x 2 root root 4096 Jul  7 13:35 tasks</span><br><span class="line">drwxr-xr-x 2 root root 4096 Jul  7 13:35 templates</span><br><span class="line">drwxr-xr-x 2 root root 4096 Jul  7 13:35 tests</span><br><span class="line">drwxr-xr-x 2 root root 4096 Jul  7 13:35 vars</span><br></pre></td></tr></table></figure><h1 id="利用gogs实现"><a href="#利用gogs实现" class="headerlink" title="利用gogs实现"></a>利用gogs实现</h1><p>查看迁移和镜像仓库设置<br>1、添加迁移外部仓库<br><img src="/archives/177a4e8b/01.png" alt=""><br>2、配置克隆地址、授权信息、迁移类型等信息<br><img src="/archives/177a4e8b/02.png" alt=""><br>3、设置仓库同步频率<br><img src="/archives/177a4e8b/03.png" alt=""><br>4、配置并立即同步<br><img src="/archives/177a4e8b/04.png" alt=""></p><h1 id="利用github-mirrors实现"><a href="#利用github-mirrors实现" class="headerlink" title="利用github-mirrors实现"></a>利用github-mirrors实现</h1><p><a href="https://docs.gitlab.com/ee/workflow/repository_mirroring.html" target="_blank" rel="noopener">https://docs.gitlab.com/ee/workflow/repository_mirroring.html</a></p><h1 id="参考资料"><a href="#参考资料" class="headerlink" title="参考资料"></a>参考资料</h1><p>======================================================<br>希望各位朋友支持一下</p><ul><li>领取我的<a href="https://promotion.aliyun.com/ntms/act/ambassador/sharetouser.html?userCode=xpdsz87p&amp;utm_source=xpdsz87p" target="_blank" rel="noopener">阿里云幸运券</a>,谢谢.</li><li>使用<a href="https://cloud.tencent.com/redirect.php?redirect=1005&amp;cps_key=5a162632de40024cd01aabff4d3f1370" target="_blank" rel="noopener">腾讯云资源</a></li><li>自己的网站承接广告<a href="http://www.sudianlm.com/track/c/?rid=2056" target="_blank" rel="noopener">速点广告联盟</a></li><li>广告位招商QQ:1455975151</li><li>喜欢购物的朋友可以看看，<a href="http://www.1zhe.com/yq/1066027" target="_blank" rel="noopener">一折特卖</a><!--注册一折特卖，免费领集分宝，集分宝可以当钱花，免费购物不是梦，注册马上送你10集分宝。--></li></ul><p><strong>本文作者</strong>：dongsheng<br><strong>本文地址</strong>： <a href="https://mds1455975151.github.io/archives/177a4e8b.html">https://mds1455975151.github.io/archives/177a4e8b.html</a> <br><strong>版权声明</strong>：转载请注明出处！</p>]]></content>
    
    <summary type="html">
    
      Git镜像仓库应用全攻略指南
    
    </summary>
    
      <category term="Git" scheme="https://mds1455975151.github.io/categories/Git/"/>
    
    
      <category term="mirror" scheme="https://mds1455975151.github.io/tags/mirror/"/>
    
      <category term="镜像仓库" scheme="https://mds1455975151.github.io/tags/%E9%95%9C%E5%83%8F%E4%BB%93%E5%BA%93/"/>
    
      <category term="webhook" scheme="https://mds1455975151.github.io/tags/webhook/"/>
    
      <category term="gitlab-mirrors" scheme="https://mds1455975151.github.io/tags/gitlab-mirrors/"/>
    
      <category term="gogs" scheme="https://mds1455975151.github.io/tags/gogs/"/>
    
  </entry>
  
  <entry>
    <title>CentOS安装显示器黑屏解决</title>
    <link href="https://mds1455975151.github.io/archives/a542927a.html"/>
    <id>https://mds1455975151.github.io/archives/a542927a.html</id>
    <published>2018-04-27T07:29:17.000Z</published>
    <updated>2018-04-27T08:27:06.345Z</updated>
    
    <content type="html"><![CDATA[<script src="\assets\js\APlayer.min.js"> </script><blockquote><p>CentOS安装显示器黑屏解决</p></blockquote><a id="more"></a><h1 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h1><p>办公室有一台闲置台式机，重做系统安装CentOS做测试机器，安装过程显示器黑屏。</p><h1 id="实践操作"><a href="#实践操作" class="headerlink" title="实践操作"></a>实践操作</h1><h2 id="环境说明"><a href="#环境说明" class="headerlink" title="环境说明"></a>环境说明</h2><p>显示器型号：Dell E2214Hv<br>报错信息如下：<br><img src="/archives/a542927a/01.jpg" alt=""></p><h2 id="问题分析及解决办法"><a href="#问题分析及解决办法" class="headerlink" title="问题分析及解决办法"></a>问题分析及解决办法</h2><p><a href="https://www.centos.org/forums/viewtopic.php?t=23977" target="_blank" rel="noopener">https://www.centos.org/forums/viewtopic.php?t=23977</a><br>在安装界面使用tab键进行选择，添加如下参数，调整输出信号分辨率<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">linux resolution=1440X900</span><br></pre></td></tr></table></figure></p><h1 id="参考资料"><a href="#参考资料" class="headerlink" title="参考资料"></a>参考资料</h1><p><a href="https://www.centos.org/forums/viewtopic.php?t=23977" target="_blank" rel="noopener">https://www.centos.org/forums/viewtopic.php?t=23977</a></p><p>======================================================<br>希望各位朋友支持一下</p><ul><li>领取我的<a href="https://promotion.aliyun.com/ntms/act/ambassador/sharetouser.html?userCode=xpdsz87p&amp;utm_source=xpdsz87p" target="_blank" rel="noopener">阿里云幸运券</a>,谢谢.</li><li>使用<a href="https://cloud.tencent.com/redirect.php?redirect=1005&amp;cps_key=5a162632de40024cd01aabff4d3f1370" target="_blank" rel="noopener">腾讯云资源</a></li><li>自己的网站承接广告<a href="http://www.sudianlm.com/track/c/?rid=2056" target="_blank" rel="noopener">速点广告联盟</a></li><li>广告位招商QQ:1455975151</li><li>喜欢购物的朋友可以看看，<a href="http://www.1zhe.com/yq/1066027" target="_blank" rel="noopener">一折特卖</a><!--注册一折特卖，免费领集分宝，集分宝可以当钱花，免费购物不是梦，注册马上送你10集分宝。--></li></ul><p><strong>本文作者</strong>：dongsheng<br><strong>本文地址</strong>： <a href="https://mds1455975151.github.io/archives/a542927a.html">https://mds1455975151.github.io/archives/a542927a.html</a> <br><strong>版权声明</strong>：转载请注明出处！</p>]]></content>
    
    <summary type="html">
    
      CentOS安装显示器黑屏解决
    
    </summary>
    
      <category term="Linux运维" scheme="https://mds1455975151.github.io/categories/Linux%E8%BF%90%E7%BB%B4/"/>
    
    
      <category term="CentOS" scheme="https://mds1455975151.github.io/tags/CentOS/"/>
    
      <category term="黑屏" scheme="https://mds1455975151.github.io/tags/%E9%BB%91%E5%B1%8F/"/>
    
  </entry>
  
  <entry>
    <title>Linux如何管理本地多个公私钥对</title>
    <link href="https://mds1455975151.github.io/archives/8a44594a.html"/>
    <id>https://mds1455975151.github.io/archives/8a44594a.html</id>
    <published>2018-04-26T09:58:23.000Z</published>
    <updated>2018-07-07T05:47:58.403Z</updated>
    
    <content type="html"><![CDATA[<script src="\assets\js\APlayer.min.js"> </script><blockquote><p>Linux如何管理本地多个公私钥对</p></blockquote><a id="more"></a><h1 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h1><p>如何在本机统一账号下使用不同的私钥访问不同的git仓库或者其他主机？</p><h1 id="实践操作"><a href="#实践操作" class="headerlink" title="实践操作"></a>实践操作</h1><ul><li><p>新增ssh的配置文件，并修改权限</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">touch ~/.ssh/config</span><br><span class="line">chmod 600 ~/.ssh/config</span><br></pre></td></tr></table></figure></li><li><p>配置内容如下(还有别名，端口等参数)：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">Host *.xxxxxx.xxx</span><br><span class="line">    IdentityFile ~/.ssh/xxxxxxxx</span><br><span class="line">    User xxxxx</span><br><span class="line"></span><br><span class="line">Host github.com</span><br><span class="line">    IdentityFile ~/.ssh/id_rsa_for_github</span><br><span class="line">    User git</span><br></pre></td></tr></table></figure></li><li><p>这样配置后就可以不用-i选项来指定私钥了</p></li></ul><h1 id="如果同一主机不同项目使用私钥不同，目前还不知道如何解决"><a href="#如果同一主机不同项目使用私钥不同，目前还不知道如何解决" class="headerlink" title="如果同一主机不同项目使用私钥不同，目前还不知道如何解决?"></a>如果同一主机不同项目使用私钥不同，目前还不知道如何解决?</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">eval &quot;$(ssh-agent -s)&quot;</span><br><span class="line">ssh-add ~/.ssh/key1</span><br><span class="line">ssh-add ~/.ssh/key2</span><br></pre></td></tr></table></figure><h1 id="参考资料"><a href="#参考资料" class="headerlink" title="参考资料"></a>参考资料</h1><p>======================================================<br>希望各位朋友支持一下</p><ul><li>领取我的<a href="https://promotion.aliyun.com/ntms/act/ambassador/sharetouser.html?userCode=xpdsz87p&amp;utm_source=xpdsz87p" target="_blank" rel="noopener">阿里云幸运券</a>,谢谢.</li><li>使用<a href="https://cloud.tencent.com/redirect.php?redirect=1005&amp;cps_key=5a162632de40024cd01aabff4d3f1370" target="_blank" rel="noopener">腾讯云资源</a></li><li>自己的网站承接广告<a href="http://www.sudianlm.com/track/c/?rid=2056" target="_blank" rel="noopener">速点广告联盟</a></li><li>广告位招商QQ:1455975151</li><li>喜欢购物的朋友可以看看，<a href="http://www.1zhe.com/yq/1066027" target="_blank" rel="noopener">一折特卖</a><!--注册一折特卖，免费领集分宝，集分宝可以当钱花，免费购物不是梦，注册马上送你10集分宝。--></li></ul><p><strong>本文作者</strong>：dongsheng<br><strong>本文地址</strong>： <a href="https://mds1455975151.github.io/archives/8a44594a.html">https://mds1455975151.github.io/archives/8a44594a.html</a> <br><strong>版权声明</strong>：转载请注明出处！</p>]]></content>
    
    <summary type="html">
    
      Linux如何管理本地多个公私钥对
    
    </summary>
    
      <category term="Linux运维" scheme="https://mds1455975151.github.io/categories/Linux%E8%BF%90%E7%BB%B4/"/>
    
    
      <category term="Linux" scheme="https://mds1455975151.github.io/tags/Linux/"/>
    
      <category term="多个公私钥对" scheme="https://mds1455975151.github.io/tags/%E5%A4%9A%E4%B8%AA%E5%85%AC%E7%A7%81%E9%92%A5%E5%AF%B9/"/>
    
  </entry>
  
  <entry>
    <title>Confluence重置管理员密码</title>
    <link href="https://mds1455975151.github.io/archives/21d5abc6.html"/>
    <id>https://mds1455975151.github.io/archives/21d5abc6.html</id>
    <published>2018-04-26T04:01:43.000Z</published>
    <updated>2018-04-26T05:57:44.645Z</updated>
    
    <content type="html"><![CDATA[<script src="\assets\js\APlayer.min.js"> </script><blockquote><p>Confluence重置管理员密码</p></blockquote><a id="more"></a><h1 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h1><p>新公司之前部署的confluence、jira系统，由于相关人员离职，无法找回密码，只能想办法重置密码。</p><h1 id="实践操作"><a href="#实践操作" class="headerlink" title="实践操作"></a>实践操作</h1><h2 id="使用MySQL存储"><a href="#使用MySQL存储" class="headerlink" title="使用MySQL存储"></a>使用MySQL存储</h2><p>思路：找到对应的数据库存储字段，直接替换为已知密码串<br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">use</span> jiradb</span><br><span class="line"><span class="keyword">select</span> * <span class="keyword">from</span> cwd_user;         // 用户列表</span><br><span class="line"><span class="keyword">select</span> * <span class="keyword">from</span> cwd_membership;   // 用户权限关系表</span><br><span class="line"></span><br><span class="line">// 重置密码语句 替换id内容为要重置用户的用户id</span><br><span class="line"><span class="keyword">update</span> cwd_user <span class="keyword">set</span> credential =  <span class="string">'x61Ey612Kl2gpFL56FT9weDnpSo4AV8j8+qx2AuTHdRyY036xxzTTrw10Wq3+4qQyB+XURPWx1ONxp3Y3pB37A=='</span>  <span class="keyword">where</span> <span class="keyword">id</span>=xxxxxx;</span><br><span class="line"></span><br><span class="line">// 如果你的密码是&#123;PKCS5S2&#125;前缀开头的，则用下面这个sql</span><br><span class="line"><span class="keyword">update</span> cwd_user <span class="keyword">set</span> credential =  <span class="string">'&#123;PKCS5S2&#125;ltrb9LlmZ0QDCJvktxd45WgYLOgPt2XTV8X7av2p0mhPvIwofs9bHYVz2OXQ6/kF'</span>  <span class="keyword">where</span> <span class="keyword">id</span>=xxxxx;</span><br><span class="line"></span><br><span class="line">修改后管理员密码为：Ab123456</span><br></pre></td></tr></table></figure></p><h1 id="参考资料"><a href="#参考资料" class="headerlink" title="参考资料"></a>参考资料</h1><p><a href="https://www.cnblogs.com/linn/p/4647327.html" target="_blank" rel="noopener">https://www.cnblogs.com/linn/p/4647327.html</a></p><p>======================================================<br>希望各位朋友支持一下</p><ul><li>领取我的<a href="https://promotion.aliyun.com/ntms/act/ambassador/sharetouser.html?userCode=xpdsz87p&amp;utm_source=xpdsz87p" target="_blank" rel="noopener">阿里云幸运券</a>,谢谢.</li><li>使用<a href="https://cloud.tencent.com/redirect.php?redirect=1005&amp;cps_key=5a162632de40024cd01aabff4d3f1370" target="_blank" rel="noopener">腾讯云资源</a></li><li>自己的网站承接广告<a href="http://www.sudianlm.com/track/c/?rid=2056" target="_blank" rel="noopener">速点广告联盟</a></li><li>广告位招商QQ:1455975151</li><li>喜欢购物的朋友可以看看，<a href="http://www.1zhe.com/yq/1066027" target="_blank" rel="noopener">一折特卖</a><!--注册一折特卖，免费领集分宝，集分宝可以当钱花，免费购物不是梦，注册马上送你10集分宝。--></li></ul><p><strong>本文作者</strong>：dongsheng<br><strong>本文地址</strong>： <a href="https://mds1455975151.github.io/archives/21d5abc6.html">https://mds1455975151.github.io/archives/21d5abc6.html</a> <br><strong>版权声明</strong>：转载请注明出处！</p>]]></content>
    
    <summary type="html">
    
      Confluence重置管理员密码
    
    </summary>
    
      <category term="Linux运维" scheme="https://mds1455975151.github.io/categories/Linux%E8%BF%90%E7%BB%B4/"/>
    
    
      <category term="Confluence" scheme="https://mds1455975151.github.io/tags/Confluence/"/>
    
  </entry>
  
  <entry>
    <title>OpenVPN最佳实践</title>
    <link href="https://mds1455975151.github.io/archives/8517c82a.html"/>
    <id>https://mds1455975151.github.io/archives/8517c82a.html</id>
    <published>2018-04-23T09:16:02.000Z</published>
    <updated>2018-04-23T09:16:07.049Z</updated>
    
    <content type="html"><![CDATA[<script src="\assets\js\APlayer.min.js"> </script><p>&gt;</p><a id="more"></a><p>======================================================<br>希望各位朋友支持一下</p><ul><li>领取我的<a href="https://promotion.aliyun.com/ntms/act/ambassador/sharetouser.html?userCode=xpdsz87p&amp;utm_source=xpdsz87p" target="_blank" rel="noopener">阿里云幸运券</a>,谢谢.</li><li>使用<a href="https://cloud.tencent.com/redirect.php?redirect=1005&amp;cps_key=5a162632de40024cd01aabff4d3f1370" target="_blank" rel="noopener">腾讯云资源</a></li><li>自己的网站承接广告<a href="http://www.sudianlm.com/track/c/?rid=2056" target="_blank" rel="noopener">速点广告联盟</a></li><li>广告位招商QQ:1455975151</li><li>喜欢购物的朋友可以看看，<a href="http://www.1zhe.com/yq/1066027" target="_blank" rel="noopener">一折特卖</a><!--注册一折特卖，免费领集分宝，集分宝可以当钱花，免费购物不是梦，注册马上送你10集分宝。--></li></ul><p><strong>本文作者</strong>：dongsheng<br><strong>本文地址</strong>： <a href="https://mds1455975151.github.io/archives/8517c82a.html">https://mds1455975151.github.io/archives/8517c82a.html</a> <br><strong>版权声明</strong>：转载请注明出处！</p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;&amp;gt;&lt;/p&gt;
    
    </summary>
    
    
  </entry>
  
  <entry>
    <title>国外域名如何转入国内</title>
    <link href="https://mds1455975151.github.io/archives/adeb23f8.html"/>
    <id>https://mds1455975151.github.io/archives/adeb23f8.html</id>
    <published>2018-04-23T08:12:44.000Z</published>
    <updated>2018-04-23T08:24:24.195Z</updated>
    
    <content type="html"><![CDATA[<script src="\assets\js\APlayer.min.js"> </script><blockquote><p>国外域名如何转入国内</p></blockquote><a id="more"></a><h1 id="需求场景"><a href="#需求场景" class="headerlink" title="需求场景"></a>需求场景</h1><p>目前域名备案全国城市不支持境外注册域名，例如在godaddy注册的域名，如果购买国内的云主机的情况，如果要备案，只能转回国内。<br>那么域名能否转回国内，具体操作流程是怎样的？</p><h1 id="实践操作"><a href="#实践操作" class="headerlink" title="实践操作"></a>实践操作</h1><p>godaddy的域名转入国内非常方便，基本上能做到10分钟就转到国内注册商。转移的过程一般流程是先解锁该域名，然后提取域名的转移码到whois邮箱。拿到域名转移码，到国内注册商（比如万网）提交域名转入。这个流程走过之后，会有个转入确认邮件发到你的域名whois邮箱。点击确认之后，再到godaddy后台释放这个域名。这样马上域名就会到国内注册商。</p><h1 id="参考资料"><a href="#参考资料" class="headerlink" title="参考资料"></a>参考资料</h1><p><a href="https://www.zhihu.com/question/23014363" target="_blank" rel="noopener">https://www.zhihu.com/question/23014363</a></p><p>======================================================<br>希望各位朋友支持一下</p><ul><li>领取我的<a href="https://promotion.aliyun.com/ntms/act/ambassador/sharetouser.html?userCode=xpdsz87p&amp;utm_source=xpdsz87p" target="_blank" rel="noopener">阿里云幸运券</a>,谢谢.</li><li>使用<a href="https://cloud.tencent.com/redirect.php?redirect=1005&amp;cps_key=5a162632de40024cd01aabff4d3f1370" target="_blank" rel="noopener">腾讯云资源</a></li><li>自己的网站承接广告<a href="http://www.sudianlm.com/track/c/?rid=2056" target="_blank" rel="noopener">速点广告联盟</a></li><li>广告位招商QQ:1455975151</li><li>喜欢购物的朋友可以看看，<a href="http://www.1zhe.com/yq/1066027" target="_blank" rel="noopener">一折特卖</a><!--注册一折特卖，免费领集分宝，集分宝可以当钱花，免费购物不是梦，注册马上送你10集分宝。--></li></ul><p><strong>本文作者</strong>：dongsheng<br><strong>本文地址</strong>： <a href="https://mds1455975151.github.io/archives/adeb23f8.html">https://mds1455975151.github.io/archives/adeb23f8.html</a> <br><strong>版权声明</strong>：转载请注明出处！</p>]]></content>
    
    <summary type="html">
    
      国外域名如何转入国内
    
    </summary>
    
      <category term="Linux运维" scheme="https://mds1455975151.github.io/categories/Linux%E8%BF%90%E7%BB%B4/"/>
    
    
      <category term="godaddy" scheme="https://mds1455975151.github.io/tags/godaddy/"/>
    
      <category term="域名备案" scheme="https://mds1455975151.github.io/tags/%E5%9F%9F%E5%90%8D%E5%A4%87%E6%A1%88/"/>
    
  </entry>
  
  <entry>
    <title>Confluence部署实践</title>
    <link href="https://mds1455975151.github.io/archives/96133d02.html"/>
    <id>https://mds1455975151.github.io/archives/96133d02.html</id>
    <published>2018-04-23T01:51:43.000Z</published>
    <updated>2018-04-23T05:50:19.504Z</updated>
    
    <content type="html"><![CDATA[<script src="\assets\js\APlayer.min.js"> </script><blockquote><p>Confluence部署实践</p></blockquote><a id="more"></a><h1 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h1><h1 id="实践操作"><a href="#实践操作" class="headerlink" title="实践操作"></a>实践操作</h1><h1 id="参考资料"><a href="#参考资料" class="headerlink" title="参考资料"></a>参考资料</h1><p><a href="https://www.cnblogs.com/kevingrace/p/7607442.html" target="_blank" rel="noopener">https://www.cnblogs.com/kevingrace/p/7607442.html</a></p><p>======================================================<br>希望各位朋友支持一下</p><ul><li>领取我的<a href="https://promotion.aliyun.com/ntms/act/ambassador/sharetouser.html?userCode=xpdsz87p&amp;utm_source=xpdsz87p" target="_blank" rel="noopener">阿里云幸运券</a>,谢谢.</li><li>使用<a href="https://cloud.tencent.com/redirect.php?redirect=1005&amp;cps_key=5a162632de40024cd01aabff4d3f1370" target="_blank" rel="noopener">腾讯云资源</a></li><li>自己的网站承接广告<a href="http://www.sudianlm.com/track/c/?rid=2056" target="_blank" rel="noopener">速点广告联盟</a></li><li>广告位招商QQ:1455975151</li><li>喜欢购物的朋友可以看看，<a href="http://www.1zhe.com/yq/1066027" target="_blank" rel="noopener">一折特卖</a><!--注册一折特卖，免费领集分宝，集分宝可以当钱花，免费购物不是梦，注册马上送你10集分宝。--></li></ul><p><strong>本文作者</strong>：dongsheng<br><strong>本文地址</strong>： <a href="https://mds1455975151.github.io/archives/96133d02.html">https://mds1455975151.github.io/archives/96133d02.html</a> <br><strong>版权声明</strong>：转载请注明出处！</p>]]></content>
    
    <summary type="html">
    
      Confluence部署实践
    
    </summary>
    
      <category term="Linux运维" scheme="https://mds1455975151.github.io/categories/Linux%E8%BF%90%E7%BB%B4/"/>
    
    
      <category term="Confluence" scheme="https://mds1455975151.github.io/tags/Confluence/"/>
    
      <category term="wiki" scheme="https://mds1455975151.github.io/tags/wiki/"/>
    
  </entry>
  
  <entry>
    <title>CentOS禁用ipv6</title>
    <link href="https://mds1455975151.github.io/archives/7da246ab.html"/>
    <id>https://mds1455975151.github.io/archives/7da246ab.html</id>
    <published>2018-04-22T10:01:36.000Z</published>
    <updated>2018-04-22T11:20:41.921Z</updated>
    
    <content type="html"><![CDATA[<script src="\assets\js\APlayer.min.js"> </script><blockquote><p>CentOS禁用ipv6</p></blockquote><a id="more"></a><h1 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h1><p>如何禁用ipv6?</p><h1 id="实践操作"><a href="#实践操作" class="headerlink" title="实践操作"></a>实践操作</h1><h2 id="根本解决办法"><a href="#根本解决办法" class="headerlink" title="根本解决办法"></a>根本解决办法</h2><blockquote><p>修改grub，在引导时就不加载IPV6模块</p></blockquote><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># vim /etc/default/grub       // 第6行添加ipv6.disable=1参数</span></span><br><span class="line">GRUB_TIMEOUT=5</span><br><span class="line">GRUB_DISTRIBUTOR=<span class="string">"<span class="variable">$(sed 's, release .*$,,g' /etc/system-release)</span>"</span></span><br><span class="line">GRUB_DEFAULT=saved</span><br><span class="line">GRUB_DISABLE_SUBMENU=<span class="literal">true</span></span><br><span class="line">GRUB_TERMINAL_OUTPUT=<span class="string">"console"</span></span><br><span class="line">GRUB_CMDLINE_LINUX=<span class="string">"ipv6.disable=1 crashkernel=auto rd.lvm.lv=centos/root rd.lvm.lv=centos/swap biosdevname=0 net.ifnames=0 rhgb quiet"</span></span><br><span class="line">GRUB_DISABLE_RECOVERY=<span class="string">"true"</span></span><br><span class="line"><span class="comment"># grub2-mkconfig -o /boot/grub2/grub.cfg</span></span><br><span class="line">Generating grub configuration file ...</span><br><span class="line">Found linux image: /boot/vmlinuz-3.10.0-693.el7.x86_64</span><br><span class="line">Found initrd image: /boot/initramfs-3.10.0-693.el7.x86_64.img</span><br><span class="line">Found linux image: /boot/vmlinuz-0-rescue-02f22e022e08404a89d15e63ef1de03f</span><br><span class="line">Found initrd image: /boot/initramfs-0-rescue-02f22e022e08404a89d15e63ef1de03f.img</span><br><span class="line"><span class="keyword">done</span></span><br><span class="line"><span class="comment"># reboot</span></span><br><span class="line"><span class="comment"># lsmod|grep ipv6</span></span><br></pre></td></tr></table></figure><h2 id="修改内核参数"><a href="#修改内核参数" class="headerlink" title="修改内核参数"></a>修改内核参数</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"># cat /proc/sys/net/ipv6/conf/all/disable_ipv6</span><br></pre></td></tr></table></figure><p><strong>If the output is 0, IPv6 is enabled.</strong><br><strong>If the output is 1, IPv6 is already disabled.</strong><br>修改前后ifconfig查看网卡信息区别<br><img src="/archives/7da246ab/01.png" alt=""><br><img src="/archives/7da246ab/02.png" alt=""><br>完整操作步骤：<br>Step 1: add this rule in /etc/sysctl.conf : net.ipv6.conf.all.disable_ipv6=1<br>Step 2: add this rule in /etc/sysconfig/network: NETWORKING_IPV6=no<br>Step 3: add this setting for each nic X (X is the corresponding number for each nic) in /etc/sysconfig/network-scripts/ifcfg-ethX: IPV6INIT=no<br>Step 4: disable the ip6tables service : chkconfig ip6tables off<br>Step 5: Reload the sysctl configuration:  sysctl -p  or reboot</p><h2 id="FQA"><a href="#FQA" class="headerlink" title="FQA"></a>FQA</h2><p>注意：禁用IPV6后，可能会导致某些服务无法启动,比如VSFTP，对于VSFTP，需要修改如下设置<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">vim /etc/vsftpd/vsftpd.conf</span><br><span class="line">listen=YES</span><br><span class="line">listen_ipv6=NO</span><br></pre></td></tr></table></figure></p><h1 id="参考资料"><a href="#参考资料" class="headerlink" title="参考资料"></a>参考资料</h1><p><a href="https://blog.csdn.net/bluishglc/article/details/41390785" target="_blank" rel="noopener">https://blog.csdn.net/bluishglc/article/details/41390785</a></p><p>======================================================<br>希望各位朋友支持一下</p><ul><li>领取我的<a href="https://promotion.aliyun.com/ntms/act/ambassador/sharetouser.html?userCode=xpdsz87p&amp;utm_source=xpdsz87p" target="_blank" rel="noopener">阿里云幸运券</a>,谢谢.</li><li>使用<a href="https://cloud.tencent.com/redirect.php?redirect=1005&amp;cps_key=5a162632de40024cd01aabff4d3f1370" target="_blank" rel="noopener">腾讯云资源</a></li><li>自己的网站承接广告<a href="http://www.sudianlm.com/track/c/?rid=2056" target="_blank" rel="noopener">速点广告联盟</a></li><li>广告位招商QQ:1455975151</li><li>喜欢购物的朋友可以看看，<a href="http://www.1zhe.com/yq/1066027" target="_blank" rel="noopener">一折特卖</a><!--注册一折特卖，免费领集分宝，集分宝可以当钱花，免费购物不是梦，注册马上送你10集分宝。--></li></ul><p><strong>本文作者</strong>：dongsheng<br><strong>本文地址</strong>： <a href="https://mds1455975151.github.io/archives/7da246ab.html">https://mds1455975151.github.io/archives/7da246ab.html</a> <br><strong>版权声明</strong>：转载请注明出处！</p>]]></content>
    
    <summary type="html">
    
      CentOS禁用ipv6
    
    </summary>
    
      <category term="Linux运维" scheme="https://mds1455975151.github.io/categories/Linux%E8%BF%90%E7%BB%B4/"/>
    
    
      <category term="CentOS" scheme="https://mds1455975151.github.io/tags/CentOS/"/>
    
      <category term="禁用IPV6" scheme="https://mds1455975151.github.io/tags/%E7%A6%81%E7%94%A8IPV6/"/>
    
  </entry>
  
  <entry>
    <title>Graylog+Elasticsearch+MongoDB+Nginx+Rsyslog日志集中收集解决方案</title>
    <link href="https://mds1455975151.github.io/archives/197f9391.html"/>
    <id>https://mds1455975151.github.io/archives/197f9391.html</id>
    <published>2018-04-22T03:30:30.000Z</published>
    <updated>2018-04-23T01:49:32.363Z</updated>
    
    <content type="html"><![CDATA[<script src="\assets\js\APlayer.min.js"> </script><blockquote><p>Graylog+Elasticsearch+MongoDB+Nginx+Rsyslog日志集中收集解决方案</p></blockquote><a id="more"></a><h1 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h1><p>Graylog官网：<a href="https://www.graylog.org/" target="_blank" rel="noopener">https://www.graylog.org/</a><br>Graylog docs： <a href="https://www.graylog.org/" target="_blank" rel="noopener">https://www.graylog.org/</a><br>Graylog download：<a href="https://www.graylog.org/" target="_blank" rel="noopener">https://www.graylog.org/</a></p><h1 id="实践操作"><a href="#实践操作" class="headerlink" title="实践操作"></a>实践操作</h1><h2 id="环境说明"><a href="#环境说明" class="headerlink" title="环境说明"></a>环境说明</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">[root@linux-node01 ~]# cat /etc/redhat-release</span><br><span class="line">CentOS Linux release 7.4.1708 (Core)</span><br><span class="line">[root@linux-node01 ~]# uname -r</span><br><span class="line">3.10.0-693.el7.x86_64</span><br><span class="line">[root@linux-node01 ~]# uname -m</span><br><span class="line">x86_64</span><br></pre></td></tr></table></figure><h2 id="MongoDB安装"><a href="#MongoDB安装" class="headerlink" title="MongoDB安装"></a>MongoDB安装</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"># yum install -y mongodb-*</span><br><span class="line"># grep -vE &quot;^$|^#&quot; /etc/mongod.conf</span><br><span class="line">bind_ip = 127.0.0.1</span><br><span class="line">port = 27017</span><br><span class="line">auth = true</span><br><span class="line"># systemctl enable mongod</span><br><span class="line"># systemctl start mongod</span><br><span class="line"># netstat -tunlp|grep mongod</span><br><span class="line">tcp        0      0 127.0.0.1:27017         0.0.0.0:*               LISTEN      3120/mongod</span><br><span class="line"># mongo</span><br><span class="line">MongoDB shell version: 2.6.12</span><br><span class="line">connecting to: test</span><br><span class="line">Welcome to the MongoDB shell.</span><br><span class="line">For interactive help, type &quot;help&quot;.</span><br><span class="line">For more comprehensive documentation, see</span><br><span class="line">        http://docs.mongodb.org/</span><br><span class="line">Questions? Try the support group</span><br><span class="line">        http://groups.google.com/group/mongodb-user</span><br><span class="line">Server has startup warnings:</span><br><span class="line">2018-04-22T12:08:56.915+0800 [initandlisten]</span><br><span class="line">2018-04-22T12:08:56.915+0800 [initandlisten] ** WARNING: Readahead for /var/lib/mongodb is set to 4096KB</span><br><span class="line">2018-04-22T12:08:56.915+0800 [initandlisten] **          We suggest setting it to 256KB (512 sectors) or less</span><br><span class="line">2018-04-22T12:08:56.915+0800 [initandlisten] **          http://dochub.mongodb.org/core/readahead</span><br><span class="line">&gt; use graylog2</span><br><span class="line">switched to db graylog2</span><br><span class="line">&gt; db.addUser(&quot;login&quot;,&quot;123456&quot;)</span><br><span class="line">WARNING: The &apos;addUser&apos; shell helper is DEPRECATED. Please use &apos;createUser&apos; instead</span><br><span class="line">Successfully added user: &#123; &quot;user&quot; : &quot;login&quot;, &quot;roles&quot; : [ &quot;dbOwner&quot; ] &#125;</span><br></pre></td></tr></table></figure><h2 id="JDK安装"><a href="#JDK安装" class="headerlink" title="JDK安装"></a>JDK安装</h2><blockquote><p>Graylog及Elasticsearch都需要java环境</p></blockquote><p><a href="http://www.oracle.com/technetwork/java/javase/downloads/jdk8-downloads-2133151.html" target="_blank" rel="noopener">JDK下载地址</a>,下载jdk-8u171-linux-x64.rpm<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># rpm -ivh jdk-8u171-linux-x64.rpm</span></span><br><span class="line"><span class="comment"># vim /etc/profile</span></span><br><span class="line"><span class="comment"># JAVA bin PATH setup</span></span><br><span class="line"><span class="built_in">export</span> JAVA_HOME=/usr/java/jdk1.8.0_171/</span><br><span class="line"><span class="built_in">export</span> CLASSPATH=.:<span class="variable">$JAVA_HOME</span>/jre/lib/rt.jar:<span class="variable">$JAVA_HOME</span>/lib/dt.jar:<span class="variable">$JAVA_HOME</span>/lib/tools.jar</span><br><span class="line"><span class="built_in">export</span> PATH=<span class="variable">$PATH</span>:<span class="variable">$JAVA_HOME</span>/bin</span><br><span class="line"><span class="comment"># java -version</span></span><br><span class="line">java version <span class="string">"1.8.0_171"</span></span><br><span class="line">Java(TM) SE Runtime Environment (build 1.8.0_171-b11)</span><br><span class="line">Java HotSpot(TM) 64-Bit Server VM (build 25.171-b11, mixed mode)</span><br></pre></td></tr></table></figure></p><h2 id="Elasticsearch安装"><a href="#Elasticsearch安装" class="headerlink" title="Elasticsearch安装"></a>Elasticsearch安装</h2><p>官网地址：<a href="https://www.elastic.co/products/elasticsearch" target="_blank" rel="noopener">https://www.elastic.co/products/elasticsearch</a><br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># wget https://artifacts.elastic.co/downloads/elasticsearch/elasticsearch-6.2.4.rpm</span></span><br><span class="line"><span class="comment"># rpm -ivh elasticsearch-6.2.4.rpm</span></span><br><span class="line"><span class="comment"># grep -vE "^$|^#" /etc/elasticsearch/elasticsearch.yml</span></span><br><span class="line">cluster.name: graylog</span><br><span class="line"><span class="comment"># systemctl daemon-reload</span></span><br><span class="line"><span class="comment"># systemctl enable elasticsearch.service</span></span><br><span class="line"><span class="comment"># systemctl start elasticsearch.service</span></span><br><span class="line"><span class="comment">#  curl -X GET http://localhost:9200</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">"name"</span> : <span class="string">"elcTqyk"</span>,</span><br><span class="line">  <span class="string">"cluster_name"</span> : <span class="string">"graylog"</span>,</span><br><span class="line">  <span class="string">"cluster_uuid"</span> : <span class="string">"NJjhhbAyToOw_6by88wG8A"</span>,</span><br><span class="line">  <span class="string">"version"</span> : &#123;</span><br><span class="line">    <span class="string">"number"</span> : <span class="string">"6.2.4"</span>,</span><br><span class="line">    <span class="string">"build_hash"</span> : <span class="string">"ccec39f"</span>,</span><br><span class="line">    <span class="string">"build_date"</span> : <span class="string">"2018-04-12T20:37:28.497551Z"</span>,</span><br><span class="line">    <span class="string">"build_snapshot"</span> : <span class="literal">false</span>,</span><br><span class="line">    <span class="string">"lucene_version"</span> : <span class="string">"7.2.1"</span>,</span><br><span class="line">    <span class="string">"minimum_wire_compatibility_version"</span> : <span class="string">"5.6.0"</span>,</span><br><span class="line">    <span class="string">"minimum_index_compatibility_version"</span> : <span class="string">"5.0.0"</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="string">"tagline"</span> : <span class="string">"You Know, for Search"</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">```/</span><br><span class="line"><span class="comment">## Graylog安装</span></span><br><span class="line">&gt; 参照官网RPM安装方式，[地址](http://docs.graylog.org/en/latest/pages/installation/operating_system_packages.html)</span><br><span class="line"></span><br><span class="line">``` bash</span><br><span class="line"><span class="comment"># yum install -y pwgen</span></span><br><span class="line"><span class="comment"># pwgen -N 1 -s 96</span></span><br><span class="line">b6lQupldhq7OdH7qac7jg0ulFHgYoVqAhwDZSpmzpLwFXTWJE3o9GqLFYA4Aac2DuXlPy91VradEgQXYvVfIcWbpT2gexAUb</span><br><span class="line"><span class="comment"># yum install -y perl-Digest-SHA</span></span><br><span class="line"><span class="comment"># echo -n 123456 | shasum -a 256</span></span><br><span class="line">8d969eef6ecad3c29a3a629280e686cf0c3f5d5a86aff3ca12020c923adc6c92  -</span><br><span class="line"></span><br><span class="line"><span class="comment"># rpm -Uvh https://packages.graylog2.org/repo/packages/graylog-2.4-repository_latest.rpm</span></span><br><span class="line"><span class="comment"># yum install -y graylog-server</span></span><br><span class="line"><span class="comment"># grep -vE "^$|^#" /etc/graylog/server/server.conf</span></span><br><span class="line">is_master = <span class="literal">true</span></span><br><span class="line">node_id_file = /etc/graylog/server/node-id</span><br><span class="line">root_username = admin</span><br><span class="line">root_password_sha2 = 8d969eef6ecad3c29a3a629280e686cf0c3f5d5a86aff3ca12020c923adc6c92</span><br><span class="line">plugin_dir = /usr/share/graylog-server/plugin</span><br><span class="line">rest_listen_uri = http://0.0.0.0:9000/api/</span><br><span class="line">rest_transport_uri = http://192.168.200.100:9000/api/</span><br><span class="line">web_listen_uri = http://0.0.0.0:9000/</span><br><span class="line">elasticsearch_hosts = http://127.0.0.1:9200</span><br><span class="line">rotation_strategy = count</span><br><span class="line">elasticsearch_max_docs_per_index = 20000000</span><br><span class="line">elasticsearch_max_number_of_indices = 20</span><br><span class="line">retention_strategy = delete</span><br><span class="line">elasticsearch_shards = 4</span><br><span class="line">elasticsearch_replicas = 0</span><br><span class="line">elasticsearch_index_prefix = graylog</span><br><span class="line">allow_leading_wildcard_searches = <span class="literal">false</span></span><br><span class="line">allow_highlighting = <span class="literal">false</span></span><br><span class="line">elasticsearch_analyzer = standard</span><br><span class="line">output_batch_size = 500</span><br><span class="line">output_flush_interval = 1</span><br><span class="line">output_fault_count_threshold = 5</span><br><span class="line">output_fault_penalty_seconds = 30</span><br><span class="line">processbuffer_processors = 5</span><br><span class="line">outputbuffer_processors = 3</span><br><span class="line">processor_wait_strategy = blocking</span><br><span class="line">ring_size = 65536</span><br><span class="line">inputbuffer_ring_size = 65536</span><br><span class="line">inputbuffer_processors = 2</span><br><span class="line">inputbuffer_wait_strategy = blocking</span><br><span class="line">message_journal_enabled = <span class="literal">true</span></span><br><span class="line">message_journal_dir = /var/lib/graylog-server/journal</span><br><span class="line">lb_recognition_period_seconds = 3</span><br><span class="line">mongodb_uri = mongodb://login:123456@localhost:27017/graylog2</span><br><span class="line">mongodb_max_connections = 1000</span><br><span class="line">mongodb_threads_allowed_to_block_multiplier = 5</span><br><span class="line">content_packs_dir = /usr/share/graylog-server/contentpacks</span><br><span class="line">content_packs_auto_load = grok-patterns.json</span><br><span class="line">proxied_requests_thread_pool_size = 32</span><br><span class="line"></span><br><span class="line"><span class="comment"># systemctl start graylog-server</span></span><br><span class="line"><span class="comment"># systemctl enable graylog-server</span></span><br></pre></td></tr></table></figure></p><h2 id="登录及测试"><a href="#登录及测试" class="headerlink" title="登录及测试"></a>登录及测试</h2><p><a href="http://192.168.200.100:9000/" target="_blank" rel="noopener">http://192.168.200.100:9000/</a><br>账号：admin<br>密码：123456</p><h1 id="参考资料"><a href="#参考资料" class="headerlink" title="参考资料"></a>参考资料</h1><p>======================================================<br>希望各位朋友支持一下</p><ul><li>领取我的<a href="https://promotion.aliyun.com/ntms/act/ambassador/sharetouser.html?userCode=xpdsz87p&amp;utm_source=xpdsz87p" target="_blank" rel="noopener">阿里云幸运券</a>,谢谢.</li><li>使用<a href="https://cloud.tencent.com/redirect.php?redirect=1005&amp;cps_key=5a162632de40024cd01aabff4d3f1370" target="_blank" rel="noopener">腾讯云资源</a></li><li>自己的网站承接广告<a href="http://www.sudianlm.com/track/c/?rid=2056" target="_blank" rel="noopener">速点广告联盟</a></li><li>广告位招商QQ:1455975151</li><li>喜欢购物的朋友可以看看，<a href="http://www.1zhe.com/yq/1066027" target="_blank" rel="noopener">一折特卖</a><!--注册一折特卖，免费领集分宝，集分宝可以当钱花，免费购物不是梦，注册马上送你10集分宝。--></li></ul><p><strong>本文作者</strong>：dongsheng<br><strong>本文地址</strong>： <a href="https://mds1455975151.github.io/archives/197f9391.html">https://mds1455975151.github.io/archives/197f9391.html</a> <br><strong>版权声明</strong>：转载请注明出处！</p>]]></content>
    
    <summary type="html">
    
      Graylog+Elasticsearch+MongoDB+Nginx+Rsyslog日志集中收集解决方案
    
    </summary>
    
      <category term="Linux运维" scheme="https://mds1455975151.github.io/categories/Linux%E8%BF%90%E7%BB%B4/"/>
    
    
      <category term="日志收集" scheme="https://mds1455975151.github.io/tags/%E6%97%A5%E5%BF%97%E6%94%B6%E9%9B%86/"/>
    
      <category term="Graylog" scheme="https://mds1455975151.github.io/tags/Graylog/"/>
    
  </entry>
  
  <entry>
    <title>Jenkins之实现自动构建Go项目</title>
    <link href="https://mds1455975151.github.io/archives/24256e32.html"/>
    <id>https://mds1455975151.github.io/archives/24256e32.html</id>
    <published>2018-04-20T06:20:54.000Z</published>
    <updated>2018-04-20T06:55:06.265Z</updated>
    
    <content type="html"><![CDATA[<script src="\assets\js\APlayer.min.js"> </script><blockquote><p>Jenkins之实现自动构建Go项目</p></blockquote><a id="more"></a><h1 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h1><p>项目需求：实现认证服务的自动构建，项目使用Go语言实现</p><h1 id="实践操作"><a href="#实践操作" class="headerlink" title="实践操作"></a>实践操作</h1><h2 id="安装插件"><a href="#安装插件" class="headerlink" title="安装插件"></a>安装插件</h2><p>[Manage Jenkins] -&gt; [Manage Plugins] -&gt; [Available] -&gt; [Go Plugin]<br><img src="/archives/24256e32/01.png" alt=""></p><blockquote><p>安装完成重启下jenkins</p></blockquote><h2 id="安装及配置Go环境"><a href="#安装及配置Go环境" class="headerlink" title="安装及配置Go环境"></a>安装及配置Go环境</h2><p><strong>安装Go环境</strong><br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># tar -zxvf /data0/src/go1.10.linux-amd64.tar.gz -C /usr/local</span></span><br><span class="line">cat &gt;&gt;/etc/profile&lt;&lt;EOF</span><br><span class="line"></span><br><span class="line"><span class="comment"># Go bin PATH setup</span></span><br><span class="line"><span class="built_in">export</span> PATH=<span class="variable">$PATH</span>:/usr/<span class="built_in">local</span>/go/bin</span><br><span class="line"><span class="built_in">export</span> GOPATH=<span class="string">"/data0/workspace/go"</span></span><br><span class="line">EOF</span><br><span class="line"><span class="comment"># mkdir -p /data0/workspace/go</span></span><br><span class="line"><span class="comment"># source  /etc/profile</span></span><br><span class="line"><span class="comment"># go env</span></span><br></pre></td></tr></table></figure></p><p><strong>配置Go环境</strong><br>全局工具管理–&gt;Go<br><img src="/archives/24256e32/02.png" alt=""></p><h2 id="添加构建项目"><a href="#添加构建项目" class="headerlink" title="添加构建项目"></a>添加构建项目</h2><p><strong>添加源码</strong><br><img src="/archives/24256e32/03.png" alt=""><br>默认情况下代码会checkout到$WORKSPACE/xxxx目录下，但是这样不符合Go项目的目录结构，需要将代码移动到正确的$GOPATH路径下</p><blockquote><p>$WORKSPACE/../src/github.com/xxxx/xxxx-auth</p></blockquote><p><strong>设置Go tools</strong><br><img src="/archives/24256e32/04.png" alt=""></p><p><strong>设置GOPATH</strong><br><img src="/archives/24256e32/05.png" alt=""><br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Create GOPATH</span></span><br><span class="line"><span class="built_in">export</span> GOPATH=<span class="variable">$WORKSPACE</span>/..</span><br><span class="line"><span class="built_in">export</span> PATH=<span class="variable">$GOPATH</span>:<span class="variable">$PATH</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Print Go version</span></span><br><span class="line">go version</span><br><span class="line"></span><br><span class="line"><span class="comment"># Run make to perform the build</span></span><br><span class="line">git_branch=`<span class="built_in">echo</span> <span class="variable">$&#123;GIT_BRANCH&#125;</span> |awk -F <span class="string">'/'</span> <span class="string">'&#123;print $2&#125;'</span>`</span><br><span class="line">git_commit=<span class="variable">$&#123;GIT_COMMIT:0:8&#125;</span></span><br><span class="line"><span class="built_in">cd</span> <span class="variable">$GOPATH</span>/src/github.com/xxxx/xxxx-auth &amp;&amp; go build</span><br><span class="line"><span class="built_in">cd</span> <span class="variable">$GOPATH</span>/src/github.com/xxxx/xxxx-auth &amp;&amp; tar -zcf <span class="variable">$WORKSPACE</span>/xxxx-auth-<span class="variable">$&#123;git_branch&#125;</span>-<span class="variable">$&#123;git_commit&#125;</span>-<span class="variable">$&#123;date_time&#125;</span>.tar.gz xxxx-auth configs scripts logs templates</span><br><span class="line"></span><br><span class="line">GIT_USER=`<span class="built_in">cd</span> <span class="variable">$GOPATH</span>/src/github.com/xxxx/xxxx-auth &amp;&amp; git <span class="built_in">log</span> --pretty=format:<span class="string">'%an'</span> -1`</span><br><span class="line">GIT_EMAIL=`<span class="built_in">cd</span> <span class="variable">$GOPATH</span>/src/github.com/xxxx/xxxx-auth &amp;&amp; git <span class="built_in">log</span> --pretty=format:<span class="string">'%ae'</span> -1`</span><br><span class="line"><span class="built_in">echo</span> <span class="variable">$GIT_USER</span></span><br><span class="line"><span class="built_in">echo</span> <span class="variable">$GIT_EMAIL</span></span><br><span class="line"><span class="keyword">if</span> [ -f profile.txt ]</span><br><span class="line"><span class="keyword">then</span></span><br><span class="line">    rm -f profile.txt</span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">"GIT_USER=<span class="variable">$GIT_USER</span>"</span>&gt;profile.txt</span><br><span class="line"><span class="built_in">echo</span> <span class="string">"GIT_EMAIL=<span class="variable">$GIT_EMAIL</span>"</span>&gt;&gt;profile.txt</span><br></pre></td></tr></table></figure></p><h2 id="检查并验证构建结果"><a href="#检查并验证构建结果" class="headerlink" title="检查并验证构建结果"></a>检查并验证构建结果</h2><p><img src="/archives/24256e32/06.png" alt=""></p><h1 id="参考资料"><a href="#参考资料" class="headerlink" title="参考资料"></a>参考资料</h1><p><a href="http://zpjiang.me/2017/08/09/Setup-Jenkins-for-Go-Projects/" target="_blank" rel="noopener">http://zpjiang.me/2017/08/09/Setup-Jenkins-for-Go-Projects/</a></p><p>======================================================<br>希望各位朋友支持一下</p><ul><li>领取我的<a href="https://promotion.aliyun.com/ntms/act/ambassador/sharetouser.html?userCode=xpdsz87p&amp;utm_source=xpdsz87p" target="_blank" rel="noopener">阿里云幸运券</a>,谢谢.</li><li>使用<a href="https://cloud.tencent.com/redirect.php?redirect=1005&amp;cps_key=5a162632de40024cd01aabff4d3f1370" target="_blank" rel="noopener">腾讯云资源</a></li><li>自己的网站承接广告<a href="http://www.sudianlm.com/track/c/?rid=2056" target="_blank" rel="noopener">速点广告联盟</a></li><li>广告位招商QQ:1455975151</li><li>喜欢购物的朋友可以看看，<a href="http://www.1zhe.com/yq/1066027" target="_blank" rel="noopener">一折特卖</a><!--注册一折特卖，免费领集分宝，集分宝可以当钱花，免费购物不是梦，注册马上送你10集分宝。--></li></ul><p><strong>本文作者</strong>：dongsheng<br><strong>本文地址</strong>： <a href="https://mds1455975151.github.io/archives/24256e32.html">https://mds1455975151.github.io/archives/24256e32.html</a> <br><strong>版权声明</strong>：转载请注明出处！</p>]]></content>
    
    <summary type="html">
    
      Jenkins之实现自动构建Go项目
    
    </summary>
    
      <category term="jenkins" scheme="https://mds1455975151.github.io/categories/jenkins/"/>
    
    
      <category term="Jenkins" scheme="https://mds1455975151.github.io/tags/Jenkins/"/>
    
      <category term="Go" scheme="https://mds1455975151.github.io/tags/Go/"/>
    
  </entry>
  
  <entry>
    <title>Go之go get与git clone区别</title>
    <link href="https://mds1455975151.github.io/archives/c008c886.html"/>
    <id>https://mds1455975151.github.io/archives/c008c886.html</id>
    <published>2018-04-20T02:24:51.000Z</published>
    <updated>2018-04-20T02:36:40.911Z</updated>
    
    <content type="html"><![CDATA[<script src="\assets\js\APlayer.min.js"> </script><p>&gt;</p><a id="more"></a><p>======================================================<br>希望各位朋友支持一下</p><ul><li>领取我的<a href="https://promotion.aliyun.com/ntms/act/ambassador/sharetouser.html?userCode=xpdsz87p&amp;utm_source=xpdsz87p" target="_blank" rel="noopener">阿里云幸运券</a>,谢谢.</li><li>使用<a href="https://cloud.tencent.com/redirect.php?redirect=1005&amp;cps_key=5a162632de40024cd01aabff4d3f1370" target="_blank" rel="noopener">腾讯云资源</a></li><li>自己的网站承接广告<a href="http://www.sudianlm.com/track/c/?rid=2056" target="_blank" rel="noopener">速点广告联盟</a></li><li>广告位招商QQ:1455975151</li><li>喜欢购物的朋友可以看看，<a href="http://www.1zhe.com/yq/1066027" target="_blank" rel="noopener">一折特卖</a><!--注册一折特卖，免费领集分宝，集分宝可以当钱花，免费购物不是梦，注册马上送你10集分宝。--></li></ul><p><strong>本文作者</strong>：dongsheng<br><strong>本文地址</strong>： <a href="https://mds1455975151.github.io/archives/c008c886.html">https://mds1455975151.github.io/archives/c008c886.html</a> <br><strong>版权声明</strong>：转载请注明出处！</p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;&amp;gt;&lt;/p&gt;
    
    </summary>
    
    
  </entry>
  
  <entry>
    <title>Linux之服务器修改SSH默认端口后git访问设置</title>
    <link href="https://mds1455975151.github.io/archives/bdb4d807.html"/>
    <id>https://mds1455975151.github.io/archives/bdb4d807.html</id>
    <published>2018-04-20T01:59:47.000Z</published>
    <updated>2018-04-20T02:41:54.402Z</updated>
    
    <content type="html"><![CDATA[<script src="\assets\js\APlayer.min.js"> </script><blockquote><p>Linux之服务器修改SSH默认端口后git访问设置</p></blockquote><a id="more"></a><h1 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h1><p>由于安全或者其它原因，可能会修改默认的SSH服务端口号，默认情况下，已有的git项目在pull或者push的时候会报错。<br>假设原来的项目的remote设置为git@github.com:mds1455975151/tools.git，将服务器SSH默认端口修改为4000后，导致pull或push出错。<br>报错信息如下：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># git pull</span></span><br><span class="line">ssh: connect to host github.com port 4000: Connection timed out</span><br><span class="line">fatal: Could not <span class="built_in">read</span> from remote repository.</span><br><span class="line"></span><br><span class="line">Please make sure you have the correct access rights</span><br><span class="line">and the repository exists.</span><br></pre></td></tr></table></figure></p><h1 id="实践记录"><a href="#实践记录" class="headerlink" title="实践记录"></a>实践记录</h1><h2 id="解决方案1：直接修改URL为SSH-开头"><a href="#解决方案1：直接修改URL为SSH-开头" class="headerlink" title="解决方案1：直接修改URL为SSH://开头"></a>解决方案1：直接修改URL为SSH://开头</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"># git remote -v</span><br><span class="line">origin  git@github.com:mds1455975151/tools.git (fetch)</span><br><span class="line">origin  git@github.com:mds1455975151/tools.git (push)</span><br><span class="line"># git remote set-url origin ssh://git@github.com:22/mds1455975151/tools.git</span><br><span class="line"># git pull</span><br></pre></td></tr></table></figure><blockquote><p>由于修改了访问方式需要添加github的deploy key</p></blockquote><h2 id="解决方案2：修改本地配置文件"><a href="#解决方案2：修改本地配置文件" class="headerlink" title="解决方案2：修改本地配置文件"></a>解决方案2：修改本地配置文件</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># cat &gt;&gt;~/.ssh/config&lt;&lt;EOF</span></span><br><span class="line"></span><br><span class="line">host proxy.github.com</span><br><span class="line">   Hostname github.com</span><br><span class="line">   Port 22</span><br><span class="line">EOF</span><br><span class="line"><span class="comment"># git remote -v</span></span><br><span class="line">origin  git@github.com:mds1455975151/tools.git (fetch)</span><br><span class="line">origin  git@github.com:mds1455975151/tools.git (push)</span><br><span class="line"><span class="comment"># git remote set-url origin git@proxy.github.com:mds1455975151/tools.git</span></span><br><span class="line"><span class="comment"># git pull</span></span><br></pre></td></tr></table></figure><h1 id="参考资料"><a href="#参考资料" class="headerlink" title="参考资料"></a>参考资料</h1><p><a href="https://blog.csdn.net/yuliying/article/details/68956765" target="_blank" rel="noopener">https://blog.csdn.net/yuliying/article/details/68956765</a></p><p>======================================================<br>希望各位朋友支持一下</p><ul><li>领取我的<a href="https://promotion.aliyun.com/ntms/act/ambassador/sharetouser.html?userCode=xpdsz87p&amp;utm_source=xpdsz87p" target="_blank" rel="noopener">阿里云幸运券</a>,谢谢.</li><li>使用<a href="https://cloud.tencent.com/redirect.php?redirect=1005&amp;cps_key=5a162632de40024cd01aabff4d3f1370" target="_blank" rel="noopener">腾讯云资源</a></li><li>自己的网站承接广告<a href="http://www.sudianlm.com/track/c/?rid=2056" target="_blank" rel="noopener">速点广告联盟</a></li><li>广告位招商QQ:1455975151</li><li>喜欢购物的朋友可以看看，<a href="http://www.1zhe.com/yq/1066027" target="_blank" rel="noopener">一折特卖</a><!--注册一折特卖，免费领集分宝，集分宝可以当钱花，免费购物不是梦，注册马上送你10集分宝。--></li></ul><p><strong>本文作者</strong>：dongsheng<br><strong>本文地址</strong>： <a href="https://mds1455975151.github.io/archives/bdb4d807.html">https://mds1455975151.github.io/archives/bdb4d807.html</a> <br><strong>版权声明</strong>：转载请注明出处！</p>]]></content>
    
    <summary type="html">
    
      Linux之服务器修改SSH默认端口后git访问设置
    
    </summary>
    
      <category term="Linux运维" scheme="https://mds1455975151.github.io/categories/Linux%E8%BF%90%E7%BB%B4/"/>
    
    
      <category term="Linux" scheme="https://mds1455975151.github.io/tags/Linux/"/>
    
      <category term="git" scheme="https://mds1455975151.github.io/tags/git/"/>
    
  </entry>
  
  <entry>
    <title>OpenLDAP之Confluence接入设置</title>
    <link href="https://mds1455975151.github.io/archives/56a056be.html"/>
    <id>https://mds1455975151.github.io/archives/56a056be.html</id>
    <published>2018-04-19T07:48:45.000Z</published>
    <updated>2018-04-21T09:47:14.509Z</updated>
    
    <content type="html"><![CDATA[<script src="\assets\js\APlayer.min.js"> </script><blockquote><p>OpenLDAP之Confluence接入设置</p></blockquote><a id="more"></a><h1 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h1><h1 id="实践操作"><a href="#实践操作" class="headerlink" title="实践操作"></a>实践操作</h1><p>第一步：启用OpenLDAP的memberof功能，方法参考请点击<a href="https://raw.githubusercontent.com/mds1455975151/tools/master/openldap/Enable_MemberOf.md" target="_blank" rel="noopener">这里</a></p><p>第二步：配置Confluence<br>站点管理–用户&amp;安全–用户目录–添加目录<br><img src="/archives/56a056be/1.png" alt=""><br><img src="/archives/56a056be/2.png" alt=""><br><img src="/archives/56a056be/3.png" alt=""><br><img src="/archives/56a056be/4.png" alt=""><br><img src="/archives/56a056be/5.png" alt=""><br><img src="/archives/56a056be/6.png" alt=""><br><img src="/archives/56a056be/7.png" alt=""><br><img src="/archives/56a056be/8.png" alt=""></p><p>第三步：配置组权限<br>站点管理–用户&amp;安全–全局权限<br><img src="/archives/56a056be/9.png" alt=""></p><h1 id="参考资料"><a href="#参考资料" class="headerlink" title="参考资料"></a>参考资料</h1><p>======================================================<br>希望各位朋友支持一下</p><ul><li>领取我的<a href="https://promotion.aliyun.com/ntms/act/ambassador/sharetouser.html?userCode=xpdsz87p&amp;utm_source=xpdsz87p" target="_blank" rel="noopener">阿里云幸运券</a>,谢谢.</li><li>使用<a href="https://cloud.tencent.com/redirect.php?redirect=1005&amp;cps_key=5a162632de40024cd01aabff4d3f1370" target="_blank" rel="noopener">腾讯云资源</a></li><li>自己的网站承接广告<a href="http://www.sudianlm.com/track/c/?rid=2056" target="_blank" rel="noopener">速点广告联盟</a></li><li>广告位招商QQ:1455975151</li><li>喜欢购物的朋友可以看看，<a href="http://www.1zhe.com/yq/1066027" target="_blank" rel="noopener">一折特卖</a><!--注册一折特卖，免费领集分宝，集分宝可以当钱花，免费购物不是梦，注册马上送你10集分宝。--></li></ul><p><strong>本文作者</strong>：dongsheng<br><strong>本文地址</strong>： <a href="https://mds1455975151.github.io/archives/56a056be.html">https://mds1455975151.github.io/archives/56a056be.html</a> <br><strong>版权声明</strong>：转载请注明出处！</p>]]></content>
    
    <summary type="html">
    
      &lt;blockquote&gt;
&lt;p&gt;OpenLDAP之Confluence接入设置&lt;/p&gt;
&lt;/blockquote&gt;
    
    </summary>
    
    
      <category term="Confluence" scheme="https://mds1455975151.github.io/tags/Confluence/"/>
    
      <category term="OpenLDAP" scheme="https://mds1455975151.github.io/tags/OpenLDAP/"/>
    
  </entry>
  
  <entry>
    <title>云数据库本地访问方法总结</title>
    <link href="https://mds1455975151.github.io/archives/5595fe34.html"/>
    <id>https://mds1455975151.github.io/archives/5595fe34.html</id>
    <published>2018-04-13T04:43:44.000Z</published>
    <updated>2018-04-13T05:11:36.697Z</updated>
    
    <content type="html"><![CDATA[<script src="\assets\js\APlayer.min.js"> </script><blockquote><p>云数据库本地访问方法总结</p></blockquote><a id="more"></a><h1 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h1><p>越来越多的企业开始使用云数据库不在自建MySQL实例，云数据库默认没有开通公网IP地址，那本地如何连接到云数据进行日常工作呢？</p><h1 id="实践记录"><a href="#实践记录" class="headerlink" title="实践记录"></a>实践记录</h1><h2 id="使用云提供商方案"><a href="#使用云提供商方案" class="headerlink" title="使用云提供商方案"></a>使用云提供商方案</h2><p>使用云提供商解决方案，直接开通外放访问权限。<br>腾讯CDB案例：<br><img src="/archives/5595fe34/04.png" alt=""></p><h2 id="利用Navicat-for-MySQL工具实现（推荐）"><a href="#利用Navicat-for-MySQL工具实现（推荐）" class="headerlink" title="利用Navicat for MySQL工具实现（推荐）"></a>利用Navicat for MySQL工具实现（推荐）</h2><p>利用工具的SSH或者HTTP方式连接到服务器后然后跳转登录到MySQL实例<br>配置数据库登录信息<br><img src="/archives/5595fe34/01.png" alt=""><br>配置服务器的SSH登录信息<br><img src="/archives/5595fe34/02.png" alt=""><br>配置HTTP登录信息<br><img src="/archives/5595fe34/03.png" alt=""></p><h2 id="命令行登录"><a href="#命令行登录" class="headerlink" title="命令行登录"></a>命令行登录</h2><p>使用ssh转发<br><a href="https://www.cnblogs.com/hfdp/p/6089811.html" target="_blank" rel="noopener">https://www.cnblogs.com/hfdp/p/6089811.html</a><br><a href="https://segmentfault.com/a/1190000009299375" target="_blank" rel="noopener">https://segmentfault.com/a/1190000009299375</a></p><h1 id="参考资料"><a href="#参考资料" class="headerlink" title="参考资料"></a>参考资料</h1><p><a href="https://cloud.tencent.com/document/product/236/3130" target="_blank" rel="noopener">https://cloud.tencent.com/document/product/236/3130</a></p><p>======================================================<br>希望各位朋友支持一下</p><ul><li>领取我的<a href="https://promotion.aliyun.com/ntms/act/ambassador/sharetouser.html?userCode=xpdsz87p&amp;utm_source=xpdsz87p" target="_blank" rel="noopener">阿里云幸运券</a>,谢谢.</li><li>使用<a href="https://cloud.tencent.com/redirect.php?redirect=1005&amp;cps_key=5a162632de40024cd01aabff4d3f1370" target="_blank" rel="noopener">腾讯云资源</a></li><li>自己的网站承接广告<a href="http://www.sudianlm.com/track/c/?rid=2056" target="_blank" rel="noopener">速点广告联盟</a></li><li>广告位招商QQ:1455975151</li><li>喜欢购物的朋友可以看看，<a href="http://www.1zhe.com/yq/1066027" target="_blank" rel="noopener">一折特卖</a><!--注册一折特卖，免费领集分宝，集分宝可以当钱花，免费购物不是梦，注册马上送你10集分宝。--></li></ul><p><strong>本文作者</strong>：dongsheng<br><strong>本文地址</strong>： <a href="https://mds1455975151.github.io/archives/5595fe34.html">https://mds1455975151.github.io/archives/5595fe34.html</a> <br><strong>版权声明</strong>：转载请注明出处！</p>]]></content>
    
    <summary type="html">
    
      云数据库本地访问方法总结
    
    </summary>
    
      <category term="Linux运维" scheme="https://mds1455975151.github.io/categories/Linux%E8%BF%90%E7%BB%B4/"/>
    
    
      <category term="云数据库" scheme="https://mds1455975151.github.io/tags/%E4%BA%91%E6%95%B0%E6%8D%AE%E5%BA%93/"/>
    
      <category term="本地访问" scheme="https://mds1455975151.github.io/tags/%E6%9C%AC%E5%9C%B0%E8%AE%BF%E9%97%AE/"/>
    
  </entry>
  
  <entry>
    <title>利用Navicat for MySQL生成MySQL差异sql规范</title>
    <link href="https://mds1455975151.github.io/archives/d6585fb.html"/>
    <id>https://mds1455975151.github.io/archives/d6585fb.html</id>
    <published>2018-04-11T11:18:03.000Z</published>
    <updated>2018-04-11T11:18:12.770Z</updated>
    
    <content type="html"><![CDATA[<script src="\assets\js\APlayer.min.js"> </script><p>&gt;</p><a id="more"></a><p>======================================================<br>希望各位朋友支持一下</p><ul><li>领取我的<a href="https://promotion.aliyun.com/ntms/act/ambassador/sharetouser.html?userCode=xpdsz87p&amp;utm_source=xpdsz87p" target="_blank" rel="noopener">阿里云幸运券</a>,谢谢.</li><li>使用<a href="https://cloud.tencent.com/redirect.php?redirect=1005&amp;cps_key=5a162632de40024cd01aabff4d3f1370" target="_blank" rel="noopener">腾讯云资源</a></li><li>自己的网站承接广告<a href="http://www.sudianlm.com/track/c/?rid=2056" target="_blank" rel="noopener">速点广告联盟</a></li><li>广告位招商QQ:1455975151</li><li>喜欢购物的朋友可以看看，<a href="http://www.1zhe.com/yq/1066027" target="_blank" rel="noopener">一折特卖</a><!--注册一折特卖，免费领集分宝，集分宝可以当钱花，免费购物不是梦，注册马上送你10集分宝。--></li></ul><p><strong>本文作者</strong>：dongsheng<br><strong>本文地址</strong>： <a href="https://mds1455975151.github.io/archives/d6585fb.html">https://mds1455975151.github.io/archives/d6585fb.html</a> <br><strong>版权声明</strong>：转载请注明出处！</p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;&amp;gt;&lt;/p&gt;
    
    </summary>
    
    
  </entry>
  
  <entry>
    <title>Zsh</title>
    <link href="https://mds1455975151.github.io/archives/d911b12b.html"/>
    <id>https://mds1455975151.github.io/archives/d911b12b.html</id>
    <published>2018-04-11T01:45:58.000Z</published>
    <updated>2018-04-11T11:16:52.716Z</updated>
    
    <content type="html"><![CDATA[<script src="\assets\js\APlayer.min.js"> </script><blockquote><p>Zsh</p></blockquote><a id="more"></a><h1 id="Zsh介绍"><a href="#Zsh介绍" class="headerlink" title="Zsh介绍"></a>Zsh介绍</h1><h1 id="Zsh部署"><a href="#Zsh部署" class="headerlink" title="Zsh部署"></a>Zsh部署</h1><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">yum install -y zsh</span><br><span class="line">sh -c <span class="string">"<span class="variable">$(curl -fsSL https://raw.github.com/robbyrussell/oh-my-zsh/master/tools/install.sh)</span>"</span></span><br><span class="line">PS1=<span class="string">'%(!.%&#123;%F&#123;yellow&#125;%&#125;.)$USER @ %&#123;$fg[white]%&#125;%M %&#123;$fg_bold[red]%&#125; %&#123;$fg_bold[green]%&#125;%p %&#123;$fg[cyan]%&#125;%c %&#123;$fg_bold[blue]%&#125;$(git_prompt_info)%&#123;$fg_bold[blue]%&#125; % %&#123;$reset_color%&#125;'</span></span><br></pre></td></tr></table></figure><h1 id="参考资料"><a href="#参考资料" class="headerlink" title="参考资料"></a>参考资料</h1><p><a href="https://github.com/robbyrussell/oh-my-zsh" target="_blank" rel="noopener">https://github.com/robbyrussell/oh-my-zsh</a></p><p>======================================================<br>希望各位朋友支持一下</p><ul><li>领取我的<a href="https://promotion.aliyun.com/ntms/act/ambassador/sharetouser.html?userCode=xpdsz87p&amp;utm_source=xpdsz87p" target="_blank" rel="noopener">阿里云幸运券</a>,谢谢.</li><li>使用<a href="https://cloud.tencent.com/redirect.php?redirect=1005&amp;cps_key=5a162632de40024cd01aabff4d3f1370" target="_blank" rel="noopener">腾讯云资源</a></li><li>自己的网站承接广告<a href="http://www.sudianlm.com/track/c/?rid=2056" target="_blank" rel="noopener">速点广告联盟</a></li><li>广告位招商QQ:1455975151</li><li>喜欢购物的朋友可以看看，<a href="http://www.1zhe.com/yq/1066027" target="_blank" rel="noopener">一折特卖</a><!--注册一折特卖，免费领集分宝，集分宝可以当钱花，免费购物不是梦，注册马上送你10集分宝。--></li></ul><p><strong>本文作者</strong>：dongsheng<br><strong>本文地址</strong>： <a href="https://mds1455975151.github.io/archives/d911b12b.html">https://mds1455975151.github.io/archives/d911b12b.html</a> <br><strong>版权声明</strong>：转载请注明出处！</p>]]></content>
    
    <summary type="html">
    
      Zsh
    
    </summary>
    
      <category term="Linux运维" scheme="https://mds1455975151.github.io/categories/Linux%E8%BF%90%E7%BB%B4/"/>
    
    
      <category term="Zsh" scheme="https://mds1455975151.github.io/tags/Zsh/"/>
    
  </entry>
  
  <entry>
    <title>Open-Falcon数据库表结构</title>
    <link href="https://mds1455975151.github.io/archives/75152a89.html"/>
    <id>https://mds1455975151.github.io/archives/75152a89.html</id>
    <published>2018-04-04T08:55:43.000Z</published>
    <updated>2018-04-04T09:15:20.761Z</updated>
    
    <content type="html"><![CDATA[<script src="\assets\js\APlayer.min.js"> </script><blockquote><p>Open-Falcon数据库表结构</p></blockquote><a id="more"></a><h1 id="1-uic-db-schema-sql"><a href="#1-uic-db-schema-sql" class="headerlink" title="1_uic-db-schema.sql"></a>1_uic-db-schema.sql</h1><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">create</span> <span class="keyword">database</span> uic</span><br><span class="line">  <span class="keyword">DEFAULT</span> <span class="built_in">CHARACTER</span> <span class="keyword">SET</span> utf8</span><br><span class="line">  <span class="keyword">DEFAULT</span> <span class="keyword">COLLATE</span> utf8_general_ci;</span><br><span class="line"><span class="keyword">USE</span> uic;</span><br><span class="line"><span class="keyword">SET</span> <span class="keyword">NAMES</span> utf8;</span><br><span class="line"></span><br><span class="line"><span class="keyword">DROP</span> <span class="keyword">TABLE</span> <span class="keyword">if</span> <span class="keyword">exists</span> team;</span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> <span class="string">`team`</span> (</span><br><span class="line">  <span class="string">`id`</span> <span class="built_in">int</span>(<span class="number">10</span>) <span class="keyword">unsigned</span> <span class="keyword">NOT</span> <span class="literal">NULL</span> AUTO_INCREMENT,</span><br><span class="line">  <span class="string">`name`</span> <span class="built_in">varchar</span>(<span class="number">64</span>) <span class="keyword">NOT</span> <span class="literal">NULL</span>,</span><br><span class="line">  <span class="string">`resume`</span> <span class="built_in">varchar</span>(<span class="number">255</span>) <span class="keyword">not</span> <span class="literal">null</span> <span class="keyword">default</span> <span class="string">''</span>,</span><br><span class="line">  <span class="string">`creator`</span> <span class="built_in">int</span>(<span class="number">10</span>) <span class="keyword">unsigned</span> <span class="keyword">NOT</span> <span class="literal">NULL</span> <span class="keyword">DEFAULT</span> <span class="string">'0'</span>,</span><br><span class="line">  <span class="string">`created`</span> <span class="keyword">timestamp</span> <span class="keyword">NOT</span> <span class="literal">NULL</span> <span class="keyword">DEFAULT</span> <span class="keyword">CURRENT_TIMESTAMP</span>,</span><br><span class="line">  PRIMARY <span class="keyword">KEY</span> (<span class="string">`id`</span>),</span><br><span class="line">  <span class="keyword">UNIQUE</span> <span class="keyword">KEY</span> <span class="string">`idx_team_name`</span> (<span class="string">`name`</span>)</span><br><span class="line">) <span class="keyword">ENGINE</span>=<span class="keyword">InnoDB</span> <span class="keyword">DEFAULT</span> <span class="keyword">CHARSET</span>=utf8;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * role: -1:blocked 0:normal 1:admin 2:root</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">DROP</span> <span class="keyword">TABLE</span> <span class="keyword">if</span> <span class="keyword">exists</span> <span class="string">`user`</span>;</span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> <span class="string">`user`</span> (</span><br><span class="line">  <span class="string">`id`</span> <span class="built_in">int</span>(<span class="number">10</span>) <span class="keyword">unsigned</span> <span class="keyword">NOT</span> <span class="literal">NULL</span> AUTO_INCREMENT,</span><br><span class="line">  <span class="string">`name`</span> <span class="built_in">varchar</span>(<span class="number">64</span>) <span class="keyword">NOT</span> <span class="literal">NULL</span>,</span><br><span class="line">  <span class="string">`passwd`</span> <span class="built_in">varchar</span>(<span class="number">64</span>) <span class="keyword">not</span> <span class="literal">null</span> <span class="keyword">default</span> <span class="string">''</span>,</span><br><span class="line">  <span class="string">`cnname`</span> <span class="built_in">varchar</span>(<span class="number">128</span>) <span class="keyword">not</span> <span class="literal">null</span> <span class="keyword">default</span> <span class="string">''</span>,</span><br><span class="line">  <span class="string">`email`</span> <span class="built_in">varchar</span>(<span class="number">255</span>) <span class="keyword">not</span> <span class="literal">null</span> <span class="keyword">default</span> <span class="string">''</span>,</span><br><span class="line">  <span class="string">`phone`</span> <span class="built_in">varchar</span>(<span class="number">16</span>) <span class="keyword">not</span> <span class="literal">null</span> <span class="keyword">default</span> <span class="string">''</span>,</span><br><span class="line">  <span class="string">`im`</span> <span class="built_in">varchar</span>(<span class="number">32</span>) <span class="keyword">not</span> <span class="literal">null</span> <span class="keyword">default</span> <span class="string">''</span>,</span><br><span class="line">  <span class="string">`qq`</span> <span class="built_in">varchar</span>(<span class="number">16</span>) <span class="keyword">not</span> <span class="literal">null</span> <span class="keyword">default</span> <span class="string">''</span>,</span><br><span class="line">  <span class="string">`role`</span> tinyint <span class="keyword">not</span> <span class="literal">null</span> <span class="keyword">default</span> <span class="number">0</span>,</span><br><span class="line">  <span class="string">`creator`</span> <span class="built_in">int</span>(<span class="number">10</span>) <span class="keyword">unsigned</span> <span class="keyword">NOT</span> <span class="literal">NULL</span> <span class="keyword">DEFAULT</span> <span class="number">0</span>,</span><br><span class="line">  <span class="string">`created`</span> <span class="keyword">timestamp</span> <span class="keyword">NOT</span> <span class="literal">NULL</span> <span class="keyword">DEFAULT</span> <span class="keyword">CURRENT_TIMESTAMP</span>,</span><br><span class="line">  PRIMARY <span class="keyword">KEY</span> (<span class="string">`id`</span>),</span><br><span class="line">  <span class="keyword">UNIQUE</span> <span class="keyword">KEY</span> <span class="string">`idx_user_name`</span> (<span class="string">`name`</span>)</span><br><span class="line">) <span class="keyword">ENGINE</span>=<span class="keyword">InnoDB</span> <span class="keyword">DEFAULT</span> <span class="keyword">CHARSET</span>=utf8;</span><br><span class="line"></span><br><span class="line"><span class="keyword">DROP</span> <span class="keyword">TABLE</span> <span class="keyword">if</span> <span class="keyword">exists</span> <span class="string">`rel_team_user`</span>;</span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> <span class="string">`rel_team_user`</span> (</span><br><span class="line">  <span class="string">`id`</span> <span class="built_in">int</span>(<span class="number">10</span>) <span class="keyword">unsigned</span> <span class="keyword">NOT</span> <span class="literal">NULL</span> AUTO_INCREMENT,</span><br><span class="line">  <span class="string">`tid`</span> <span class="built_in">int</span>(<span class="number">10</span>) <span class="keyword">unsigned</span> <span class="keyword">not</span> <span class="literal">null</span>,</span><br><span class="line">  <span class="string">`uid`</span> <span class="built_in">int</span>(<span class="number">10</span>) <span class="keyword">unsigned</span> <span class="keyword">not</span> <span class="literal">null</span>,</span><br><span class="line">  PRIMARY <span class="keyword">KEY</span> (<span class="string">`id`</span>),</span><br><span class="line">  <span class="keyword">KEY</span> <span class="string">`idx_rel_tid`</span> (<span class="string">`tid`</span>),</span><br><span class="line">  <span class="keyword">KEY</span> <span class="string">`idx_rel_uid`</span> (<span class="string">`uid`</span>)</span><br><span class="line">) <span class="keyword">ENGINE</span>=<span class="keyword">InnoDB</span> <span class="keyword">DEFAULT</span> <span class="keyword">CHARSET</span>=utf8;</span><br><span class="line"></span><br><span class="line"><span class="keyword">DROP</span> <span class="keyword">TABLE</span> <span class="keyword">if</span> <span class="keyword">exists</span> <span class="string">`session`</span>;</span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> <span class="string">`session`</span> (</span><br><span class="line">  <span class="string">`id`</span> <span class="built_in">int</span>(<span class="number">10</span>) <span class="keyword">unsigned</span> <span class="keyword">NOT</span> <span class="literal">NULL</span> AUTO_INCREMENT,</span><br><span class="line">  <span class="string">`uid`</span> <span class="built_in">int</span>(<span class="number">10</span>) <span class="keyword">unsigned</span> <span class="keyword">not</span> <span class="literal">null</span>,</span><br><span class="line">  <span class="string">`sig`</span> <span class="built_in">varchar</span>(<span class="number">32</span>) <span class="keyword">not</span> <span class="literal">null</span>,</span><br><span class="line">  <span class="string">`expired`</span> <span class="built_in">int</span>(<span class="number">10</span>) <span class="keyword">unsigned</span> <span class="keyword">not</span> <span class="literal">null</span>,</span><br><span class="line">  PRIMARY <span class="keyword">KEY</span> (<span class="string">`id`</span>),</span><br><span class="line">  <span class="keyword">KEY</span> <span class="string">`idx_session_uid`</span> (<span class="string">`uid`</span>),</span><br><span class="line">  <span class="keyword">KEY</span> <span class="string">`idx_session_sig`</span> (<span class="string">`sig`</span>)</span><br><span class="line">) <span class="keyword">ENGINE</span>=<span class="keyword">InnoDB</span> <span class="keyword">DEFAULT</span> <span class="keyword">CHARSET</span>=utf8;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*900150983cd24fb0d6963f7d28e17f72*/</span></span><br><span class="line"><span class="comment">/*insert into `user`(`name`, `passwd`, `role`, `created`) values('root', md5('abc'), 2, now());*/</span></span><br></pre></td></tr></table></figure><h1 id="2-portal-db-schema-sql"><a href="#2-portal-db-schema-sql" class="headerlink" title="2_portal-db-schema.sql"></a>2_portal-db-schema.sql</h1><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">DATABASE</span> falcon_portal</span><br><span class="line">  <span class="keyword">DEFAULT</span> <span class="built_in">CHARACTER</span> <span class="keyword">SET</span> utf8</span><br><span class="line">  <span class="keyword">DEFAULT</span> <span class="keyword">COLLATE</span> utf8_general_ci;</span><br><span class="line"><span class="keyword">USE</span> falcon_portal;</span><br><span class="line"><span class="keyword">SET</span> <span class="keyword">NAMES</span> utf8;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 这里的机器是从机器管理系统中同步过来的</span></span><br><span class="line"><span class="comment"> * 系统拿出来单独部署需要为hbs增加功能，心跳上来的机器写入host表</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">DROP</span> <span class="keyword">TABLE</span> <span class="keyword">IF</span> <span class="keyword">EXISTS</span> host;</span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> host</span><br><span class="line">(</span><br><span class="line">  <span class="keyword">id</span>             <span class="built_in">INT</span> <span class="keyword">UNSIGNED</span> <span class="keyword">NOT</span> <span class="literal">NULL</span> AUTO_INCREMENT,</span><br><span class="line">  hostname       <span class="built_in">VARCHAR</span>(<span class="number">255</span>) <span class="keyword">NOT</span> <span class="literal">NULL</span> <span class="keyword">DEFAULT</span> <span class="string">''</span>,</span><br><span class="line">  ip             <span class="built_in">VARCHAR</span>(<span class="number">16</span>)  <span class="keyword">NOT</span> <span class="literal">NULL</span> <span class="keyword">DEFAULT</span> <span class="string">''</span>,</span><br><span class="line">  agent_version  <span class="built_in">VARCHAR</span>(<span class="number">16</span>)  <span class="keyword">NOT</span> <span class="literal">NULL</span> <span class="keyword">DEFAULT</span> <span class="string">''</span>,</span><br><span class="line">  plugin_version <span class="built_in">VARCHAR</span>(<span class="number">128</span>) <span class="keyword">NOT</span> <span class="literal">NULL</span> <span class="keyword">DEFAULT</span> <span class="string">''</span>,</span><br><span class="line">  maintain_begin <span class="built_in">INT</span> <span class="keyword">UNSIGNED</span> <span class="keyword">NOT</span> <span class="literal">NULL</span> <span class="keyword">DEFAULT</span> <span class="number">0</span>,</span><br><span class="line">  maintain_end   <span class="built_in">INT</span> <span class="keyword">UNSIGNED</span> <span class="keyword">NOT</span> <span class="literal">NULL</span> <span class="keyword">DEFAULT</span> <span class="number">0</span>,</span><br><span class="line">  update_at      <span class="keyword">TIMESTAMP</span>    <span class="keyword">NOT</span> <span class="literal">NULL</span> <span class="keyword">DEFAULT</span> <span class="keyword">CURRENT_TIMESTAMP</span> <span class="keyword">on</span> <span class="keyword">update</span> <span class="keyword">CURRENT_TIMESTAMP</span>,</span><br><span class="line">  PRIMARY <span class="keyword">KEY</span> (<span class="keyword">id</span>),</span><br><span class="line">  <span class="keyword">UNIQUE</span> <span class="keyword">KEY</span> idx_host_hostname (hostname)</span><br><span class="line">)</span><br><span class="line">  <span class="keyword">ENGINE</span> =<span class="keyword">InnoDB</span></span><br><span class="line">  <span class="keyword">DEFAULT</span> <span class="keyword">CHARSET</span> =utf8</span><br><span class="line">  <span class="keyword">COLLATE</span> =utf8_unicode_ci;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 机器分组信息</span></span><br><span class="line"><span class="comment"> * come_from 0: 从机器管理同步过来的；1: 从页面创建的</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">DROP</span> <span class="keyword">TABLE</span> <span class="keyword">IF</span> <span class="keyword">EXISTS</span> grp;</span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> <span class="string">`grp`</span> (</span><br><span class="line">  <span class="keyword">id</span>          <span class="built_in">INT</span>(<span class="number">10</span>) <span class="keyword">UNSIGNED</span> <span class="keyword">NOT</span> <span class="literal">NULL</span> AUTO_INCREMENT,</span><br><span class="line">  grp_name    <span class="built_in">VARCHAR</span>(<span class="number">255</span>)     <span class="keyword">NOT</span> <span class="literal">NULL</span> <span class="keyword">DEFAULT</span> <span class="string">''</span>,</span><br><span class="line">  create_user <span class="built_in">VARCHAR</span>(<span class="number">64</span>)      <span class="keyword">NOT</span> <span class="literal">NULL</span> <span class="keyword">DEFAULT</span> <span class="string">''</span>,</span><br><span class="line">  create_at   <span class="keyword">TIMESTAMP</span>        <span class="keyword">NOT</span> <span class="literal">NULL</span> <span class="keyword">DEFAULT</span> <span class="keyword">CURRENT_TIMESTAMP</span>,</span><br><span class="line">  come_from   TINYINT(<span class="number">4</span>)       <span class="keyword">NOT</span> <span class="literal">NULL</span> <span class="keyword">DEFAULT</span> <span class="string">'0'</span>,</span><br><span class="line">  PRIMARY <span class="keyword">KEY</span> (<span class="keyword">id</span>),</span><br><span class="line">  <span class="keyword">UNIQUE</span> <span class="keyword">KEY</span> idx_host_grp_grp_name (grp_name)</span><br><span class="line">)</span><br><span class="line">  <span class="keyword">ENGINE</span> =<span class="keyword">InnoDB</span></span><br><span class="line">  <span class="keyword">DEFAULT</span> <span class="keyword">CHARSET</span> =utf8</span><br><span class="line">  <span class="keyword">COLLATE</span> =utf8_unicode_ci;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">DROP</span> <span class="keyword">TABLE</span> <span class="keyword">IF</span> <span class="keyword">EXISTS</span> grp_host;</span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> grp_host</span><br><span class="line">(</span><br><span class="line">  grp_id  <span class="built_in">INT</span> <span class="keyword">UNSIGNED</span> <span class="keyword">NOT</span> <span class="literal">NULL</span>,</span><br><span class="line">  host_id <span class="built_in">INT</span> <span class="keyword">UNSIGNED</span> <span class="keyword">NOT</span> <span class="literal">NULL</span>,</span><br><span class="line">  <span class="keyword">KEY</span> idx_grp_host_grp_id (grp_id),</span><br><span class="line">  <span class="keyword">KEY</span> idx_grp_host_host_id (host_id)</span><br><span class="line">)</span><br><span class="line">  <span class="keyword">ENGINE</span> =<span class="keyword">InnoDB</span></span><br><span class="line">  <span class="keyword">DEFAULT</span> <span class="keyword">CHARSET</span> =utf8</span><br><span class="line">  <span class="keyword">COLLATE</span> =utf8_unicode_ci;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 监控策略模板</span></span><br><span class="line"><span class="comment"> * tpl_name全局唯一，命名的时候可以适当带上一些前缀，比如：sa.falcon.base</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">DROP</span> <span class="keyword">TABLE</span> <span class="keyword">IF</span> <span class="keyword">EXISTS</span> tpl;</span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> tpl</span><br><span class="line">(</span><br><span class="line">  <span class="keyword">id</span>          <span class="built_in">INT</span> <span class="keyword">UNSIGNED</span> <span class="keyword">NOT</span> <span class="literal">NULL</span> AUTO_INCREMENT,</span><br><span class="line">  tpl_name    <span class="built_in">VARCHAR</span>(<span class="number">255</span>) <span class="keyword">NOT</span> <span class="literal">NULL</span> <span class="keyword">DEFAULT</span> <span class="string">''</span>,</span><br><span class="line">  parent_id   <span class="built_in">INT</span> <span class="keyword">UNSIGNED</span> <span class="keyword">NOT</span> <span class="literal">NULL</span> <span class="keyword">DEFAULT</span> <span class="number">0</span>,</span><br><span class="line">  action_id   <span class="built_in">INT</span> <span class="keyword">UNSIGNED</span> <span class="keyword">NOT</span> <span class="literal">NULL</span> <span class="keyword">DEFAULT</span> <span class="number">0</span>,</span><br><span class="line">  create_user <span class="built_in">VARCHAR</span>(<span class="number">64</span>)  <span class="keyword">NOT</span> <span class="literal">NULL</span> <span class="keyword">DEFAULT</span> <span class="string">''</span>,</span><br><span class="line">  create_at   <span class="keyword">TIMESTAMP</span>    <span class="keyword">NOT</span> <span class="literal">NULL</span> <span class="keyword">DEFAULT</span> <span class="keyword">CURRENT_TIMESTAMP</span>,</span><br><span class="line">  PRIMARY <span class="keyword">KEY</span> (<span class="keyword">id</span>),</span><br><span class="line">  <span class="keyword">UNIQUE</span> <span class="keyword">KEY</span> idx_tpl_name (tpl_name),</span><br><span class="line">  <span class="keyword">KEY</span> idx_tpl_create_user (create_user)</span><br><span class="line">)</span><br><span class="line">  <span class="keyword">ENGINE</span> =<span class="keyword">InnoDB</span></span><br><span class="line">  <span class="keyword">DEFAULT</span> <span class="keyword">CHARSET</span> =utf8</span><br><span class="line">  <span class="keyword">COLLATE</span> =utf8_unicode_ci;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">DROP</span> <span class="keyword">TABLE</span> <span class="keyword">IF</span> <span class="keyword">EXISTS</span> strategy;</span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> <span class="string">`strategy`</span> (</span><br><span class="line">  <span class="string">`id`</span>          <span class="built_in">INT</span>(<span class="number">10</span>) <span class="keyword">UNSIGNED</span> <span class="keyword">NOT</span> <span class="literal">NULL</span> AUTO_INCREMENT,</span><br><span class="line">  <span class="string">`metric`</span>      <span class="built_in">VARCHAR</span>(<span class="number">128</span>)     <span class="keyword">NOT</span> <span class="literal">NULL</span> <span class="keyword">DEFAULT</span> <span class="string">''</span>,</span><br><span class="line">  <span class="string">`tags`</span>        <span class="built_in">VARCHAR</span>(<span class="number">256</span>)     <span class="keyword">NOT</span> <span class="literal">NULL</span> <span class="keyword">DEFAULT</span> <span class="string">''</span>,</span><br><span class="line">  <span class="string">`max_step`</span>    <span class="built_in">INT</span>(<span class="number">11</span>)          <span class="keyword">NOT</span> <span class="literal">NULL</span> <span class="keyword">DEFAULT</span> <span class="string">'1'</span>,</span><br><span class="line">  <span class="string">`priority`</span>    TINYINT(<span class="number">4</span>)       <span class="keyword">NOT</span> <span class="literal">NULL</span> <span class="keyword">DEFAULT</span> <span class="string">'0'</span>,</span><br><span class="line">  <span class="string">`func`</span>        <span class="built_in">VARCHAR</span>(<span class="number">16</span>)      <span class="keyword">NOT</span> <span class="literal">NULL</span> <span class="keyword">DEFAULT</span> <span class="string">'all(#1)'</span>,</span><br><span class="line">  <span class="string">`op`</span>          <span class="built_in">VARCHAR</span>(<span class="number">8</span>)       <span class="keyword">NOT</span> <span class="literal">NULL</span> <span class="keyword">DEFAULT</span> <span class="string">''</span>,</span><br><span class="line">  <span class="string">`right_value`</span> <span class="built_in">VARCHAR</span>(<span class="number">64</span>)      <span class="keyword">NOT</span> <span class="literal">NULL</span>,</span><br><span class="line">  <span class="string">`note`</span>        <span class="built_in">VARCHAR</span>(<span class="number">128</span>)     <span class="keyword">NOT</span> <span class="literal">NULL</span> <span class="keyword">DEFAULT</span> <span class="string">''</span>,</span><br><span class="line">  <span class="string">`run_begin`</span>   <span class="built_in">VARCHAR</span>(<span class="number">16</span>)      <span class="keyword">NOT</span> <span class="literal">NULL</span> <span class="keyword">DEFAULT</span> <span class="string">''</span>,</span><br><span class="line">  <span class="string">`run_end`</span>     <span class="built_in">VARCHAR</span>(<span class="number">16</span>)      <span class="keyword">NOT</span> <span class="literal">NULL</span> <span class="keyword">DEFAULT</span> <span class="string">''</span>,</span><br><span class="line">  <span class="string">`tpl_id`</span>      <span class="built_in">INT</span>(<span class="number">10</span>) <span class="keyword">UNSIGNED</span> <span class="keyword">NOT</span> <span class="literal">NULL</span> <span class="keyword">DEFAULT</span> <span class="string">'0'</span>,</span><br><span class="line">  PRIMARY <span class="keyword">KEY</span> (<span class="string">`id`</span>),</span><br><span class="line">  <span class="keyword">KEY</span> <span class="string">`idx_strategy_tpl_id`</span> (<span class="string">`tpl_id`</span>)</span><br><span class="line">)</span><br><span class="line">  <span class="keyword">ENGINE</span> =<span class="keyword">InnoDB</span></span><br><span class="line">  <span class="keyword">DEFAULT</span> <span class="keyword">CHARSET</span> =utf8</span><br><span class="line">  <span class="keyword">COLLATE</span> =utf8_unicode_ci;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">DROP</span> <span class="keyword">TABLE</span> <span class="keyword">IF</span> <span class="keyword">EXISTS</span> expression;</span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> <span class="string">`expression`</span> (</span><br><span class="line">  <span class="string">`id`</span>          <span class="built_in">INT</span>(<span class="number">10</span>) <span class="keyword">UNSIGNED</span> <span class="keyword">NOT</span> <span class="literal">NULL</span> AUTO_INCREMENT,</span><br><span class="line">  <span class="string">`expression`</span>  <span class="built_in">VARCHAR</span>(<span class="number">1024</span>)    <span class="keyword">NOT</span> <span class="literal">NULL</span>,</span><br><span class="line">  <span class="string">`func`</span>        <span class="built_in">VARCHAR</span>(<span class="number">16</span>)      <span class="keyword">NOT</span> <span class="literal">NULL</span> <span class="keyword">DEFAULT</span> <span class="string">'all(#1)'</span>,</span><br><span class="line">  <span class="string">`op`</span>          <span class="built_in">VARCHAR</span>(<span class="number">8</span>)       <span class="keyword">NOT</span> <span class="literal">NULL</span> <span class="keyword">DEFAULT</span> <span class="string">''</span>,</span><br><span class="line">  <span class="string">`right_value`</span> <span class="built_in">VARCHAR</span>(<span class="number">16</span>)      <span class="keyword">NOT</span> <span class="literal">NULL</span> <span class="keyword">DEFAULT</span> <span class="string">''</span>,</span><br><span class="line">  <span class="string">`max_step`</span>    <span class="built_in">INT</span>(<span class="number">11</span>)          <span class="keyword">NOT</span> <span class="literal">NULL</span> <span class="keyword">DEFAULT</span> <span class="string">'1'</span>,</span><br><span class="line">  <span class="string">`priority`</span>    TINYINT(<span class="number">4</span>)       <span class="keyword">NOT</span> <span class="literal">NULL</span> <span class="keyword">DEFAULT</span> <span class="string">'0'</span>,</span><br><span class="line">  <span class="string">`note`</span>        <span class="built_in">VARCHAR</span>(<span class="number">1024</span>)    <span class="keyword">NOT</span> <span class="literal">NULL</span> <span class="keyword">DEFAULT</span> <span class="string">''</span>,</span><br><span class="line">  <span class="string">`action_id`</span>   <span class="built_in">INT</span>(<span class="number">10</span>) <span class="keyword">UNSIGNED</span> <span class="keyword">NOT</span> <span class="literal">NULL</span> <span class="keyword">DEFAULT</span> <span class="string">'0'</span>,</span><br><span class="line">  <span class="string">`create_user`</span> <span class="built_in">VARCHAR</span>(<span class="number">64</span>)      <span class="keyword">NOT</span> <span class="literal">NULL</span> <span class="keyword">DEFAULT</span> <span class="string">''</span>,</span><br><span class="line">  <span class="string">`pause`</span>       TINYINT(<span class="number">1</span>)       <span class="keyword">NOT</span> <span class="literal">NULL</span> <span class="keyword">DEFAULT</span> <span class="string">'0'</span>,</span><br><span class="line">  PRIMARY <span class="keyword">KEY</span> (<span class="string">`id`</span>)</span><br><span class="line">)</span><br><span class="line">  <span class="keyword">ENGINE</span> =<span class="keyword">InnoDB</span></span><br><span class="line">  <span class="keyword">DEFAULT</span> <span class="keyword">CHARSET</span> =utf8</span><br><span class="line">  <span class="keyword">COLLATE</span> =utf8_unicode_ci;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">DROP</span> <span class="keyword">TABLE</span> <span class="keyword">IF</span> <span class="keyword">EXISTS</span> grp_tpl;</span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> <span class="string">`grp_tpl`</span> (</span><br><span class="line">  <span class="string">`grp_id`</span>    <span class="built_in">INT</span>(<span class="number">10</span>) <span class="keyword">UNSIGNED</span> <span class="keyword">NOT</span> <span class="literal">NULL</span>,</span><br><span class="line">  <span class="string">`tpl_id`</span>    <span class="built_in">INT</span>(<span class="number">10</span>) <span class="keyword">UNSIGNED</span> <span class="keyword">NOT</span> <span class="literal">NULL</span>,</span><br><span class="line">  <span class="string">`bind_user`</span> <span class="built_in">VARCHAR</span>(<span class="number">64</span>)      <span class="keyword">NOT</span> <span class="literal">NULL</span> <span class="keyword">DEFAULT</span> <span class="string">''</span>,</span><br><span class="line">  <span class="keyword">KEY</span> <span class="string">`idx_grp_tpl_grp_id`</span> (<span class="string">`grp_id`</span>),</span><br><span class="line">  <span class="keyword">KEY</span> <span class="string">`idx_grp_tpl_tpl_id`</span> (<span class="string">`tpl_id`</span>)</span><br><span class="line">)</span><br><span class="line">  <span class="keyword">ENGINE</span> =<span class="keyword">InnoDB</span></span><br><span class="line">  <span class="keyword">DEFAULT</span> <span class="keyword">CHARSET</span> =utf8</span><br><span class="line">  <span class="keyword">COLLATE</span> =utf8_unicode_ci;</span><br><span class="line"></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> <span class="string">`plugin_dir`</span> (</span><br><span class="line">  <span class="string">`id`</span>          <span class="built_in">INT</span>(<span class="number">10</span>) <span class="keyword">UNSIGNED</span> <span class="keyword">NOT</span> <span class="literal">NULL</span> AUTO_INCREMENT,</span><br><span class="line">  <span class="string">`grp_id`</span>      <span class="built_in">INT</span>(<span class="number">10</span>) <span class="keyword">UNSIGNED</span> <span class="keyword">NOT</span> <span class="literal">NULL</span>,</span><br><span class="line">  <span class="string">`dir`</span>         <span class="built_in">VARCHAR</span>(<span class="number">255</span>)     <span class="keyword">NOT</span> <span class="literal">NULL</span>,</span><br><span class="line">  <span class="string">`create_user`</span> <span class="built_in">VARCHAR</span>(<span class="number">64</span>)      <span class="keyword">NOT</span> <span class="literal">NULL</span> <span class="keyword">DEFAULT</span> <span class="string">''</span>,</span><br><span class="line">  <span class="string">`create_at`</span>   <span class="keyword">TIMESTAMP</span>        <span class="keyword">NOT</span> <span class="literal">NULL</span> <span class="keyword">DEFAULT</span> <span class="keyword">CURRENT_TIMESTAMP</span>,</span><br><span class="line">  PRIMARY <span class="keyword">KEY</span> (<span class="string">`id`</span>),</span><br><span class="line">  <span class="keyword">KEY</span> <span class="string">`idx_plugin_dir_grp_id`</span> (<span class="string">`grp_id`</span>)</span><br><span class="line">)</span><br><span class="line">  <span class="keyword">ENGINE</span> =<span class="keyword">InnoDB</span></span><br><span class="line">  <span class="keyword">DEFAULT</span> <span class="keyword">CHARSET</span> =utf8</span><br><span class="line">  <span class="keyword">COLLATE</span> =utf8_unicode_ci;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">DROP</span> <span class="keyword">TABLE</span> <span class="keyword">IF</span> <span class="keyword">EXISTS</span> <span class="keyword">action</span>;</span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> <span class="string">`action`</span> (</span><br><span class="line">  <span class="string">`id`</span>                   <span class="built_in">INT</span>(<span class="number">10</span>) <span class="keyword">UNSIGNED</span> <span class="keyword">NOT</span> <span class="literal">NULL</span> AUTO_INCREMENT,</span><br><span class="line">  <span class="string">`uic`</span>                  <span class="built_in">VARCHAR</span>(<span class="number">255</span>)     <span class="keyword">NOT</span> <span class="literal">NULL</span> <span class="keyword">DEFAULT</span> <span class="string">''</span>,</span><br><span class="line">  <span class="string">`url`</span>                  <span class="built_in">VARCHAR</span>(<span class="number">255</span>)     <span class="keyword">NOT</span> <span class="literal">NULL</span> <span class="keyword">DEFAULT</span> <span class="string">''</span>,</span><br><span class="line">  <span class="string">`callback`</span>             TINYINT(<span class="number">4</span>)       <span class="keyword">NOT</span> <span class="literal">NULL</span> <span class="keyword">DEFAULT</span> <span class="string">'0'</span>,</span><br><span class="line">  <span class="string">`before_callback_sms`</span>  TINYINT(<span class="number">4</span>)       <span class="keyword">NOT</span> <span class="literal">NULL</span> <span class="keyword">DEFAULT</span> <span class="string">'0'</span>,</span><br><span class="line">  <span class="string">`before_callback_mail`</span> TINYINT(<span class="number">4</span>)       <span class="keyword">NOT</span> <span class="literal">NULL</span> <span class="keyword">DEFAULT</span> <span class="string">'0'</span>,</span><br><span class="line">  <span class="string">`after_callback_sms`</span>   TINYINT(<span class="number">4</span>)       <span class="keyword">NOT</span> <span class="literal">NULL</span> <span class="keyword">DEFAULT</span> <span class="string">'0'</span>,</span><br><span class="line">  <span class="string">`after_callback_mail`</span>  TINYINT(<span class="number">4</span>)       <span class="keyword">NOT</span> <span class="literal">NULL</span> <span class="keyword">DEFAULT</span> <span class="string">'0'</span>,</span><br><span class="line">  PRIMARY <span class="keyword">KEY</span> (<span class="string">`id`</span>)</span><br><span class="line">)</span><br><span class="line">  <span class="keyword">ENGINE</span> =<span class="keyword">InnoDB</span></span><br><span class="line">  <span class="keyword">DEFAULT</span> <span class="keyword">CHARSET</span> =utf8</span><br><span class="line">  <span class="keyword">COLLATE</span> =utf8_unicode_ci;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * nodata mock config</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">DROP</span> <span class="keyword">TABLE</span> <span class="keyword">IF</span> <span class="keyword">EXISTS</span> <span class="string">`mockcfg`</span>;</span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> <span class="string">`mockcfg`</span> (</span><br><span class="line">  <span class="string">`id`</span>       <span class="built_in">BIGINT</span>(<span class="number">20</span>) <span class="keyword">UNSIGNED</span> <span class="keyword">NOT</span> <span class="literal">NULL</span> AUTO_INCREMENT,</span><br><span class="line">  <span class="string">`name`</span>     <span class="built_in">VARCHAR</span>(<span class="number">255</span>) <span class="keyword">NOT</span> <span class="literal">NULL</span> <span class="keyword">DEFAULT</span> <span class="string">''</span> <span class="keyword">COMMENT</span> <span class="string">'name of mockcfg, used for uuid'</span>,</span><br><span class="line">  <span class="string">`obj`</span>      <span class="built_in">VARCHAR</span>(<span class="number">10240</span>) <span class="keyword">NOT</span> <span class="literal">NULL</span> <span class="keyword">DEFAULT</span> <span class="string">''</span> <span class="keyword">COMMENT</span> <span class="string">'desc of object'</span>,</span><br><span class="line">  <span class="string">`obj_type`</span> <span class="built_in">VARCHAR</span>(<span class="number">255</span>) <span class="keyword">NOT</span> <span class="literal">NULL</span> <span class="keyword">DEFAULT</span> <span class="string">''</span> <span class="keyword">COMMENT</span> <span class="string">'type of object, host or group or other'</span>,</span><br><span class="line">  <span class="string">`metric`</span>   <span class="built_in">VARCHAR</span>(<span class="number">128</span>) <span class="keyword">NOT</span> <span class="literal">NULL</span> <span class="keyword">DEFAULT</span> <span class="string">''</span>,</span><br><span class="line">  <span class="string">`tags`</span>     <span class="built_in">VARCHAR</span>(<span class="number">1024</span>) <span class="keyword">NOT</span> <span class="literal">NULL</span> <span class="keyword">DEFAULT</span> <span class="string">''</span>,</span><br><span class="line">  <span class="string">`dstype`</span>   <span class="built_in">VARCHAR</span>(<span class="number">32</span>)  <span class="keyword">NOT</span> <span class="literal">NULL</span> <span class="keyword">DEFAULT</span> <span class="string">'GAUGE'</span>,</span><br><span class="line">  <span class="string">`step`</span>     <span class="built_in">INT</span>(<span class="number">11</span>) <span class="keyword">UNSIGNED</span>  <span class="keyword">NOT</span> <span class="literal">NULL</span> <span class="keyword">DEFAULT</span> <span class="number">60</span>,</span><br><span class="line">  <span class="string">`mock`</span>     <span class="keyword">DOUBLE</span>  <span class="keyword">NOT</span> <span class="literal">NULL</span> <span class="keyword">DEFAULT</span> <span class="number">0</span>  <span class="keyword">COMMENT</span> <span class="string">'mocked value when nodata occurs'</span>,</span><br><span class="line">  <span class="string">`creator`</span>  <span class="built_in">VARCHAR</span>(<span class="number">64</span>)  <span class="keyword">NOT</span> <span class="literal">NULL</span> <span class="keyword">DEFAULT</span> <span class="string">''</span>,</span><br><span class="line">  <span class="string">`t_create`</span> DATETIME <span class="keyword">NOT</span> <span class="literal">NULL</span> <span class="keyword">COMMENT</span> <span class="string">'create time'</span>,</span><br><span class="line">  <span class="string">`t_modify`</span> <span class="keyword">TIMESTAMP</span> <span class="keyword">NOT</span> <span class="literal">NULL</span> <span class="keyword">DEFAULT</span> <span class="keyword">CURRENT_TIMESTAMP</span> <span class="keyword">ON</span> <span class="keyword">UPDATE</span> <span class="keyword">CURRENT_TIMESTAMP</span> <span class="keyword">COMMENT</span> <span class="string">'last modify time'</span>,</span><br><span class="line">  PRIMARY <span class="keyword">KEY</span> (<span class="string">`id`</span>),</span><br><span class="line">  <span class="keyword">UNIQUE</span> <span class="keyword">KEY</span> <span class="string">`uniq_name`</span> (<span class="string">`name`</span>)</span><br><span class="line">)</span><br><span class="line">  <span class="keyword">ENGINE</span>=<span class="keyword">InnoDB</span></span><br><span class="line">  <span class="keyword">DEFAULT</span> <span class="keyword">CHARSET</span>=utf8</span><br><span class="line">  <span class="keyword">COLLATE</span>=utf8_unicode_ci;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> *  aggregator cluster metric config table</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">DROP</span> <span class="keyword">TABLE</span> <span class="keyword">IF</span> <span class="keyword">EXISTS</span> <span class="string">`cluster`</span>;</span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> <span class="string">`cluster`</span> (</span><br><span class="line">  <span class="string">`id`</span>          <span class="built_in">INT</span> <span class="keyword">UNSIGNED</span>   <span class="keyword">NOT</span> <span class="literal">NULL</span> AUTO_INCREMENT,</span><br><span class="line">  <span class="string">`grp_id`</span>      <span class="built_in">INT</span>            <span class="keyword">NOT</span> <span class="literal">NULL</span>,</span><br><span class="line">  <span class="string">`numerator`</span>   <span class="built_in">VARCHAR</span>(<span class="number">10240</span>) <span class="keyword">NOT</span> <span class="literal">NULL</span>,</span><br><span class="line">  <span class="string">`denominator`</span> <span class="built_in">VARCHAR</span>(<span class="number">10240</span>) <span class="keyword">NOT</span> <span class="literal">NULL</span>,</span><br><span class="line">  <span class="string">`endpoint`</span>    <span class="built_in">VARCHAR</span>(<span class="number">255</span>)   <span class="keyword">NOT</span> <span class="literal">NULL</span>,</span><br><span class="line">  <span class="string">`metric`</span>      <span class="built_in">VARCHAR</span>(<span class="number">255</span>)   <span class="keyword">NOT</span> <span class="literal">NULL</span>,</span><br><span class="line">  <span class="string">`tags`</span>        <span class="built_in">VARCHAR</span>(<span class="number">255</span>)   <span class="keyword">NOT</span> <span class="literal">NULL</span>,</span><br><span class="line">  <span class="string">`ds_type`</span>     <span class="built_in">VARCHAR</span>(<span class="number">255</span>)   <span class="keyword">NOT</span> <span class="literal">NULL</span>,</span><br><span class="line">  <span class="string">`step`</span>        <span class="built_in">INT</span>            <span class="keyword">NOT</span> <span class="literal">NULL</span>,</span><br><span class="line">  <span class="string">`last_update`</span> <span class="keyword">TIMESTAMP</span>      <span class="keyword">NOT</span> <span class="literal">NULL</span> <span class="keyword">DEFAULT</span> <span class="keyword">CURRENT_TIMESTAMP</span> <span class="keyword">ON</span> <span class="keyword">UPDATE</span> <span class="keyword">CURRENT_TIMESTAMP</span>,</span><br><span class="line">  <span class="string">`creator`</span>     <span class="built_in">VARCHAR</span>(<span class="number">255</span>)   <span class="keyword">NOT</span> <span class="literal">NULL</span>,</span><br><span class="line">  PRIMARY <span class="keyword">KEY</span> (<span class="string">`id`</span>)</span><br><span class="line">)</span><br><span class="line">  <span class="keyword">ENGINE</span> =<span class="keyword">InnoDB</span></span><br><span class="line">  <span class="keyword">DEFAULT</span> <span class="keyword">CHARSET</span>=utf8</span><br><span class="line">  <span class="keyword">COLLATE</span>=utf8_unicode_ci;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * alert links</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">DROP</span> <span class="keyword">TABLE</span> <span class="keyword">IF</span> <span class="keyword">EXISTS</span> alert_link;</span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> alert_link</span><br><span class="line">(</span><br><span class="line">  <span class="keyword">id</span>        <span class="built_in">INT</span> <span class="keyword">UNSIGNED</span> <span class="keyword">NOT</span> <span class="literal">NULL</span> AUTO_INCREMENT,</span><br><span class="line">  <span class="keyword">path</span>      <span class="built_in">VARCHAR</span>(<span class="number">16</span>)  <span class="keyword">NOT</span> <span class="literal">NULL</span> <span class="keyword">DEFAULT</span> <span class="string">''</span>,</span><br><span class="line">  <span class="keyword">content</span>   <span class="built_in">TEXT</span>         <span class="keyword">NOT</span> <span class="literal">NULL</span>,</span><br><span class="line">  create_at <span class="keyword">TIMESTAMP</span>    <span class="keyword">NOT</span> <span class="literal">NULL</span> <span class="keyword">DEFAULT</span> <span class="keyword">CURRENT_TIMESTAMP</span>,</span><br><span class="line">  PRIMARY <span class="keyword">KEY</span> (<span class="keyword">id</span>),</span><br><span class="line">  <span class="keyword">UNIQUE</span> <span class="keyword">KEY</span> alert_path(<span class="keyword">path</span>)</span><br><span class="line">)</span><br><span class="line">  <span class="keyword">ENGINE</span> =<span class="keyword">InnoDB</span></span><br><span class="line">  <span class="keyword">DEFAULT</span> <span class="keyword">CHARSET</span> =utf8</span><br><span class="line">  <span class="keyword">COLLATE</span> =utf8_unicode_ci;</span><br></pre></td></tr></table></figure><h1 id="3-dashboard-db-schema-sql"><a href="#3-dashboard-db-schema-sql" class="headerlink" title="3_dashboard-db-schema.sql"></a>3_dashboard-db-schema.sql</h1><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- MySQL dump 10.13  Distrib 5.5.31, for Linux (x86_64)</span></span><br><span class="line"><span class="comment">--</span></span><br><span class="line"><span class="comment">-- Host: 127.0.0.1    Database: dashboard</span></span><br><span class="line"><span class="comment">-- ------------------------------------------------------</span></span><br><span class="line"><span class="comment">-- Server version5.5.31-log</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/*!40101 SET @OLD_CHARACTER_SET_CLIENT=@@CHARACTER_SET_CLIENT */</span>;</span><br><span class="line"><span class="comment">/*!40101 SET @OLD_CHARACTER_SET_RESULTS=@@CHARACTER_SET_RESULTS */</span>;</span><br><span class="line"><span class="comment">/*!40101 SET @OLD_COLLATION_CONNECTION=@@COLLATION_CONNECTION */</span>;</span><br><span class="line"><span class="comment">/*!40101 SET NAMES utf8 */</span>;</span><br><span class="line"><span class="comment">/*!40103 SET @OLD_TIME_ZONE=@@TIME_ZONE */</span>;</span><br><span class="line"><span class="comment">/*!40103 SET TIME_ZONE='+00:00' */</span>;</span><br><span class="line"><span class="comment">/*!40014 SET @OLD_UNIQUE_CHECKS=@@UNIQUE_CHECKS, UNIQUE_CHECKS=0 */</span>;</span><br><span class="line"><span class="comment">/*!40014 SET @OLD_FOREIGN_KEY_CHECKS=@@FOREIGN_KEY_CHECKS, FOREIGN_KEY_CHECKS=0 */</span>;</span><br><span class="line"><span class="comment">/*!40101 SET @OLD_SQL_MODE=@@SQL_MODE, SQL_MODE='NO_AUTO_VALUE_ON_ZERO' */</span>;</span><br><span class="line"><span class="comment">/*!40111 SET @OLD_SQL_NOTES=@@SQL_NOTES, SQL_NOTES=0 */</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">--</span></span><br><span class="line"><span class="comment">-- Table structure for table `dashboard_graph`</span></span><br><span class="line"><span class="comment">--</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">DATABASE</span> dashboard</span><br><span class="line">  <span class="keyword">DEFAULT</span> <span class="built_in">CHARACTER</span> <span class="keyword">SET</span> utf8</span><br><span class="line">  <span class="keyword">DEFAULT</span> <span class="keyword">COLLATE</span> utf8_general_ci;</span><br><span class="line"><span class="keyword">USE</span> dashboard;</span><br><span class="line"><span class="keyword">SET</span> <span class="keyword">NAMES</span> utf8;</span><br><span class="line"></span><br><span class="line"><span class="keyword">DROP</span> <span class="keyword">TABLE</span> <span class="keyword">IF</span> <span class="keyword">EXISTS</span> <span class="string">`dashboard_graph`</span>;</span><br><span class="line"><span class="comment">/*!40101 SET @saved_cs_client     = @@character_set_client */</span>;</span><br><span class="line"><span class="comment">/*!40101 SET character_set_client = utf8 */</span>;</span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> <span class="string">`dashboard_graph`</span> (</span><br><span class="line">  <span class="string">`id`</span> <span class="built_in">int</span>(<span class="number">11</span>) <span class="keyword">unsigned</span> <span class="keyword">NOT</span> <span class="literal">NULL</span> AUTO_INCREMENT,</span><br><span class="line">  <span class="string">`title`</span> <span class="built_in">char</span>(<span class="number">128</span>) <span class="keyword">NOT</span> <span class="literal">NULL</span>,</span><br><span class="line">  <span class="string">`hosts`</span> <span class="built_in">varchar</span>(<span class="number">10240</span>) <span class="keyword">NOT</span> <span class="literal">NULL</span> <span class="keyword">DEFAULT</span> <span class="string">''</span>,</span><br><span class="line">  <span class="string">`counters`</span> <span class="built_in">varchar</span>(<span class="number">1024</span>) <span class="keyword">NOT</span> <span class="literal">NULL</span> <span class="keyword">DEFAULT</span> <span class="string">''</span>,</span><br><span class="line">  <span class="string">`screen_id`</span> <span class="built_in">int</span>(<span class="number">11</span>) <span class="keyword">unsigned</span> <span class="keyword">NOT</span> <span class="literal">NULL</span>,</span><br><span class="line">  <span class="string">`timespan`</span> <span class="built_in">int</span>(<span class="number">11</span>) <span class="keyword">unsigned</span> <span class="keyword">NOT</span> <span class="literal">NULL</span> <span class="keyword">DEFAULT</span> <span class="string">'3600'</span>,</span><br><span class="line">  <span class="string">`graph_type`</span> <span class="built_in">char</span>(<span class="number">2</span>) <span class="keyword">NOT</span> <span class="literal">NULL</span> <span class="keyword">DEFAULT</span> <span class="string">'h'</span>,</span><br><span class="line">  <span class="string">`method`</span> <span class="built_in">char</span>(<span class="number">8</span>) <span class="keyword">DEFAULT</span> <span class="string">''</span>,</span><br><span class="line">  <span class="string">`position`</span> <span class="built_in">int</span>(<span class="number">11</span>) <span class="keyword">unsigned</span> <span class="keyword">NOT</span> <span class="literal">NULL</span> <span class="keyword">DEFAULT</span> <span class="string">'0'</span>,</span><br><span class="line">  <span class="string">`falcon_tags`</span> <span class="built_in">varchar</span>(<span class="number">512</span>) <span class="keyword">NOT</span> <span class="literal">NULL</span> <span class="keyword">DEFAULT</span> <span class="string">''</span>,</span><br><span class="line">  PRIMARY <span class="keyword">KEY</span> (<span class="string">`id`</span>),</span><br><span class="line">  <span class="keyword">KEY</span> <span class="string">`idx_sid`</span> (<span class="string">`screen_id`</span>)</span><br><span class="line">) <span class="keyword">ENGINE</span>=<span class="keyword">InnoDB</span> <span class="keyword">DEFAULT</span> <span class="keyword">CHARSET</span>=utf8;</span><br><span class="line"><span class="comment">/*!40101 SET character_set_client = @saved_cs_client */</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">--</span></span><br><span class="line"><span class="comment">-- Table structure for table `dashboard_screen`</span></span><br><span class="line"><span class="comment">--</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">DROP</span> <span class="keyword">TABLE</span> <span class="keyword">IF</span> <span class="keyword">EXISTS</span> <span class="string">`dashboard_screen`</span>;</span><br><span class="line"><span class="comment">/*!40101 SET @saved_cs_client     = @@character_set_client */</span>;</span><br><span class="line"><span class="comment">/*!40101 SET character_set_client = utf8 */</span>;</span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> <span class="string">`dashboard_screen`</span> (</span><br><span class="line">  <span class="string">`id`</span> <span class="built_in">int</span>(<span class="number">11</span>) <span class="keyword">unsigned</span> <span class="keyword">NOT</span> <span class="literal">NULL</span> AUTO_INCREMENT,</span><br><span class="line">  <span class="string">`pid`</span> <span class="built_in">int</span>(<span class="number">11</span>) <span class="keyword">unsigned</span> <span class="keyword">NOT</span> <span class="literal">NULL</span> <span class="keyword">DEFAULT</span> <span class="string">'0'</span>,</span><br><span class="line">  <span class="string">`name`</span> <span class="built_in">char</span>(<span class="number">128</span>) <span class="keyword">NOT</span> <span class="literal">NULL</span>,</span><br><span class="line">  <span class="string">`time`</span> <span class="keyword">timestamp</span> <span class="keyword">NOT</span> <span class="literal">NULL</span> <span class="keyword">DEFAULT</span> <span class="keyword">CURRENT_TIMESTAMP</span> <span class="keyword">ON</span> <span class="keyword">UPDATE</span> <span class="keyword">CURRENT_TIMESTAMP</span>,</span><br><span class="line">  PRIMARY <span class="keyword">KEY</span> (<span class="string">`id`</span>),</span><br><span class="line">  <span class="keyword">KEY</span> <span class="string">`idx_pid`</span> (<span class="string">`pid`</span>),</span><br><span class="line">  <span class="keyword">UNIQUE</span> <span class="keyword">KEY</span> <span class="string">`idx_pid_n`</span> (<span class="string">`pid`</span>,<span class="string">`name`</span>)</span><br><span class="line">) <span class="keyword">ENGINE</span>=<span class="keyword">InnoDB</span> <span class="keyword">DEFAULT</span> <span class="keyword">CHARSET</span>=utf8;</span><br><span class="line"><span class="comment">/*!40101 SET character_set_client = @saved_cs_client */</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">--</span></span><br><span class="line"><span class="comment">-- Table structure for table `tmp_graph`</span></span><br><span class="line"><span class="comment">--</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">DROP</span> <span class="keyword">TABLE</span> <span class="keyword">IF</span> <span class="keyword">EXISTS</span> <span class="string">`tmp_graph`</span>;</span><br><span class="line"><span class="comment">/*!40101 SET @saved_cs_client     = @@character_set_client */</span>;</span><br><span class="line"><span class="comment">/*!40101 SET character_set_client = utf8 */</span>;</span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> <span class="string">`tmp_graph`</span> (</span><br><span class="line">  <span class="string">`id`</span> <span class="built_in">int</span>(<span class="number">11</span>) <span class="keyword">unsigned</span> <span class="keyword">NOT</span> <span class="literal">NULL</span> AUTO_INCREMENT,</span><br><span class="line">  <span class="string">`endpoints`</span> <span class="built_in">varchar</span>(<span class="number">10240</span>) <span class="keyword">NOT</span> <span class="literal">NULL</span> <span class="keyword">DEFAULT</span> <span class="string">''</span>,</span><br><span class="line">  <span class="string">`counters`</span> <span class="built_in">varchar</span>(<span class="number">10240</span>) <span class="keyword">NOT</span> <span class="literal">NULL</span> <span class="keyword">DEFAULT</span> <span class="string">''</span>,</span><br><span class="line">  <span class="string">`ck`</span> <span class="built_in">varchar</span>(<span class="number">32</span>) <span class="keyword">NOT</span> <span class="literal">NULL</span>,</span><br><span class="line">  <span class="string">`time_`</span> <span class="keyword">timestamp</span> <span class="keyword">NOT</span> <span class="literal">NULL</span> <span class="keyword">DEFAULT</span> <span class="keyword">CURRENT_TIMESTAMP</span>,</span><br><span class="line">  PRIMARY <span class="keyword">KEY</span> (<span class="string">`id`</span>),</span><br><span class="line">  <span class="keyword">UNIQUE</span> <span class="keyword">KEY</span> <span class="string">`idx_ck`</span> (<span class="string">`ck`</span>)</span><br><span class="line">) <span class="keyword">ENGINE</span>=<span class="keyword">InnoDB</span> <span class="keyword">DEFAULT</span> <span class="keyword">CHARSET</span>=utf8;</span><br><span class="line"><span class="comment">/*!40101 SET character_set_client = @saved_cs_client */</span>;</span><br><span class="line"><span class="comment">/*!40103 SET TIME_ZONE=@OLD_TIME_ZONE */</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*!40101 SET SQL_MODE=@OLD_SQL_MODE */</span>;</span><br><span class="line"><span class="comment">/*!40014 SET FOREIGN_KEY_CHECKS=@OLD_FOREIGN_KEY_CHECKS */</span>;</span><br><span class="line"><span class="comment">/*!40014 SET UNIQUE_CHECKS=@OLD_UNIQUE_CHECKS */</span>;</span><br><span class="line"><span class="comment">/*!40101 SET CHARACTER_SET_CLIENT=@OLD_CHARACTER_SET_CLIENT */</span>;</span><br><span class="line"><span class="comment">/*!40101 SET CHARACTER_SET_RESULTS=@OLD_CHARACTER_SET_RESULTS */</span>;</span><br><span class="line"><span class="comment">/*!40101 SET COLLATION_CONNECTION=@OLD_COLLATION_CONNECTION */</span>;</span><br><span class="line"><span class="comment">/*!40111 SET SQL_NOTES=@OLD_SQL_NOTES */</span>;</span><br></pre></td></tr></table></figure><h1 id="4-graph-db-schema-sql"><a href="#4-graph-db-schema-sql" class="headerlink" title="4_graph-db-schema.sql"></a>4_graph-db-schema.sql</h1><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">DATABASE</span> graph</span><br><span class="line">  <span class="keyword">DEFAULT</span> <span class="built_in">CHARACTER</span> <span class="keyword">SET</span> utf8</span><br><span class="line">  <span class="keyword">DEFAULT</span> <span class="keyword">COLLATE</span> utf8_general_ci;</span><br><span class="line"><span class="keyword">USE</span> graph;</span><br><span class="line"><span class="keyword">SET</span> <span class="keyword">NAMES</span> utf8;</span><br><span class="line"></span><br><span class="line"><span class="keyword">DROP</span> <span class="keyword">TABLE</span> <span class="keyword">if</span> <span class="keyword">exists</span> <span class="string">`graph`</span>.<span class="string">`endpoint`</span>;</span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> <span class="string">`graph`</span>.<span class="string">`endpoint`</span> (</span><br><span class="line">  <span class="string">`id`</span> <span class="built_in">int</span>(<span class="number">10</span>) <span class="keyword">unsigned</span> <span class="keyword">NOT</span> <span class="literal">NULL</span> AUTO_INCREMENT,</span><br><span class="line">  <span class="string">`endpoint`</span> <span class="built_in">varchar</span>(<span class="number">255</span>) <span class="keyword">NOT</span> <span class="literal">NULL</span> <span class="keyword">DEFAULT</span> <span class="string">''</span>,</span><br><span class="line">  <span class="string">`ts`</span> <span class="built_in">int</span>(<span class="number">11</span>) <span class="keyword">DEFAULT</span> <span class="literal">NULL</span>,</span><br><span class="line">  <span class="string">`t_create`</span> DATETIME <span class="keyword">NOT</span> <span class="literal">NULL</span> <span class="keyword">COMMENT</span> <span class="string">'create time'</span>,</span><br><span class="line">  <span class="string">`t_modify`</span> <span class="keyword">TIMESTAMP</span> <span class="keyword">NOT</span> <span class="literal">NULL</span> <span class="keyword">DEFAULT</span> <span class="keyword">CURRENT_TIMESTAMP</span> <span class="keyword">ON</span> <span class="keyword">UPDATE</span> <span class="keyword">CURRENT_TIMESTAMP</span> <span class="keyword">COMMENT</span> <span class="string">'last modify time'</span>,</span><br><span class="line">  PRIMARY <span class="keyword">KEY</span> (<span class="string">`id`</span>),</span><br><span class="line">  <span class="keyword">UNIQUE</span> <span class="keyword">KEY</span> <span class="string">`idx_endpoint`</span> (<span class="string">`endpoint`</span>)</span><br><span class="line">) <span class="keyword">ENGINE</span>=<span class="keyword">InnoDB</span> <span class="keyword">DEFAULT</span> <span class="keyword">CHARSET</span>=utf8;</span><br><span class="line"></span><br><span class="line"><span class="keyword">DROP</span> <span class="keyword">TABLE</span> <span class="keyword">if</span> <span class="keyword">exists</span> <span class="string">`graph`</span>.<span class="string">`endpoint_counter`</span>;</span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> <span class="string">`graph`</span>.<span class="string">`endpoint_counter`</span> (</span><br><span class="line">  <span class="string">`id`</span> <span class="built_in">int</span>(<span class="number">10</span>) <span class="keyword">unsigned</span> <span class="keyword">NOT</span> <span class="literal">NULL</span> AUTO_INCREMENT,</span><br><span class="line">  <span class="string">`endpoint_id`</span> <span class="built_in">int</span>(<span class="number">10</span>) <span class="keyword">unsigned</span> <span class="keyword">NOT</span> <span class="literal">NULL</span>,</span><br><span class="line">  <span class="string">`counter`</span> <span class="built_in">varchar</span>(<span class="number">255</span>) <span class="keyword">NOT</span> <span class="literal">NULL</span> <span class="keyword">DEFAULT</span> <span class="string">''</span>,</span><br><span class="line">  <span class="string">`step`</span> <span class="built_in">int</span>(<span class="number">11</span>) <span class="keyword">not</span> <span class="literal">null</span> <span class="keyword">default</span> <span class="number">60</span> <span class="keyword">comment</span> <span class="string">'in second'</span>,</span><br><span class="line">  <span class="string">`type`</span> <span class="built_in">varchar</span>(<span class="number">16</span>) <span class="keyword">not</span> <span class="literal">null</span> <span class="keyword">comment</span> <span class="string">'GAUGE|COUNTER|DERIVE'</span>,</span><br><span class="line">  <span class="string">`ts`</span> <span class="built_in">int</span>(<span class="number">11</span>) <span class="keyword">DEFAULT</span> <span class="literal">NULL</span>,</span><br><span class="line">  <span class="string">`t_create`</span> DATETIME <span class="keyword">NOT</span> <span class="literal">NULL</span> <span class="keyword">COMMENT</span> <span class="string">'create time'</span>,</span><br><span class="line">  <span class="string">`t_modify`</span> <span class="keyword">TIMESTAMP</span> <span class="keyword">NOT</span> <span class="literal">NULL</span> <span class="keyword">DEFAULT</span> <span class="keyword">CURRENT_TIMESTAMP</span> <span class="keyword">ON</span> <span class="keyword">UPDATE</span> <span class="keyword">CURRENT_TIMESTAMP</span> <span class="keyword">COMMENT</span> <span class="string">'last modify time'</span>,</span><br><span class="line">  PRIMARY <span class="keyword">KEY</span> (<span class="string">`id`</span>),</span><br><span class="line">  <span class="keyword">UNIQUE</span> <span class="keyword">KEY</span> <span class="string">`idx_endpoint_id_counter`</span> (<span class="string">`endpoint_id`</span>, <span class="string">`counter`</span>)</span><br><span class="line">) <span class="keyword">ENGINE</span>=<span class="keyword">InnoDB</span> <span class="keyword">DEFAULT</span> <span class="keyword">CHARSET</span>=utf8;</span><br><span class="line"></span><br><span class="line"><span class="keyword">DROP</span> <span class="keyword">TABLE</span> <span class="keyword">if</span> <span class="keyword">exists</span> <span class="string">`graph`</span>.<span class="string">`tag_endpoint`</span>;</span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> <span class="string">`graph`</span>.<span class="string">`tag_endpoint`</span> (</span><br><span class="line">  <span class="string">`id`</span> <span class="built_in">int</span>(<span class="number">10</span>) <span class="keyword">unsigned</span> <span class="keyword">NOT</span> <span class="literal">NULL</span> AUTO_INCREMENT,</span><br><span class="line">  <span class="string">`tag`</span> <span class="built_in">varchar</span>(<span class="number">255</span>) <span class="keyword">NOT</span> <span class="literal">NULL</span> <span class="keyword">DEFAULT</span> <span class="string">''</span> <span class="keyword">COMMENT</span> <span class="string">'srv=tv'</span>,</span><br><span class="line">  <span class="string">`endpoint_id`</span> <span class="built_in">int</span>(<span class="number">10</span>) <span class="keyword">unsigned</span> <span class="keyword">NOT</span> <span class="literal">NULL</span>,</span><br><span class="line">  <span class="string">`ts`</span> <span class="built_in">int</span>(<span class="number">11</span>) <span class="keyword">DEFAULT</span> <span class="literal">NULL</span>,</span><br><span class="line">  <span class="string">`t_create`</span> DATETIME <span class="keyword">NOT</span> <span class="literal">NULL</span> <span class="keyword">COMMENT</span> <span class="string">'create time'</span>,</span><br><span class="line">  <span class="string">`t_modify`</span> <span class="keyword">TIMESTAMP</span> <span class="keyword">NOT</span> <span class="literal">NULL</span> <span class="keyword">DEFAULT</span> <span class="keyword">CURRENT_TIMESTAMP</span> <span class="keyword">ON</span> <span class="keyword">UPDATE</span> <span class="keyword">CURRENT_TIMESTAMP</span> <span class="keyword">COMMENT</span> <span class="string">'last modify time'</span>,</span><br><span class="line">  PRIMARY <span class="keyword">KEY</span> (<span class="string">`id`</span>),</span><br><span class="line">  <span class="keyword">UNIQUE</span> <span class="keyword">KEY</span> <span class="string">`idx_tag_endpoint_id`</span> (<span class="string">`tag`</span>, <span class="string">`endpoint_id`</span>)</span><br><span class="line">) <span class="keyword">ENGINE</span>=<span class="keyword">InnoDB</span> <span class="keyword">DEFAULT</span> <span class="keyword">CHARSET</span>=utf8;</span><br></pre></td></tr></table></figure><h1 id="5-alarms-db-schema-sql"><a href="#5-alarms-db-schema-sql" class="headerlink" title="5_alarms-db-schema.sql"></a>5_alarms-db-schema.sql</h1><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">DATABASE</span> alarms</span><br><span class="line">  <span class="keyword">DEFAULT</span> <span class="built_in">CHARACTER</span> <span class="keyword">SET</span> utf8</span><br><span class="line">  <span class="keyword">DEFAULT</span> <span class="keyword">COLLATE</span> utf8_general_ci;</span><br><span class="line"><span class="keyword">USE</span> alarms;</span><br><span class="line"><span class="keyword">SET</span> <span class="keyword">NAMES</span> utf8;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">* 建立告警归档资料表, 主要存储各个告警的最后触发状况</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="keyword">DROP</span> <span class="keyword">TABLE</span> <span class="keyword">IF</span> <span class="keyword">EXISTS</span> event_cases;</span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> <span class="keyword">IF</span> <span class="keyword">NOT</span> <span class="keyword">EXISTS</span> event_cases(</span><br><span class="line">                <span class="keyword">id</span> <span class="built_in">VARCHAR</span>(<span class="number">50</span>),</span><br><span class="line">                endpoint <span class="built_in">VARCHAR</span>(<span class="number">100</span>) <span class="keyword">NOT</span> <span class="literal">NULL</span>,</span><br><span class="line">                metric <span class="built_in">VARCHAR</span>(<span class="number">200</span>) <span class="keyword">NOT</span> <span class="literal">NULL</span>,</span><br><span class="line">                func <span class="built_in">VARCHAR</span>(<span class="number">50</span>),</span><br><span class="line">                cond <span class="built_in">VARCHAR</span>(<span class="number">200</span>) <span class="keyword">NOT</span> <span class="literal">NULL</span>,</span><br><span class="line">                note <span class="built_in">VARCHAR</span>(<span class="number">500</span>),</span><br><span class="line">                max_step <span class="built_in">int</span>(<span class="number">10</span>) <span class="keyword">unsigned</span>,</span><br><span class="line">                current_step <span class="built_in">int</span>(<span class="number">10</span>) <span class="keyword">unsigned</span>,</span><br><span class="line">                <span class="keyword">priority</span> <span class="built_in">INT</span>(<span class="number">6</span>) <span class="keyword">NOT</span> <span class="literal">NULL</span>,</span><br><span class="line">                <span class="keyword">status</span> <span class="built_in">VARCHAR</span>(<span class="number">20</span>) <span class="keyword">NOT</span> <span class="literal">NULL</span>,</span><br><span class="line">                <span class="keyword">timestamp</span> <span class="keyword">Timestamp</span> <span class="keyword">NOT</span> <span class="literal">NULL</span>,</span><br><span class="line">                update_at <span class="keyword">Timestamp</span> <span class="literal">NULL</span> <span class="keyword">DEFAULT</span> <span class="literal">NULL</span>,</span><br><span class="line">                closed_at <span class="keyword">Timestamp</span> <span class="literal">NULL</span> <span class="keyword">DEFAULT</span> <span class="literal">NULL</span>,</span><br><span class="line">                closed_note <span class="built_in">VARCHAR</span>(<span class="number">250</span>),</span><br><span class="line">                user_modified <span class="built_in">int</span>(<span class="number">10</span>) <span class="keyword">unsigned</span>,</span><br><span class="line">                tpl_creator <span class="built_in">VARCHAR</span>(<span class="number">64</span>),</span><br><span class="line">                expression_id <span class="built_in">int</span>(<span class="number">10</span>) <span class="keyword">unsigned</span>,</span><br><span class="line">                strategy_id <span class="built_in">int</span>(<span class="number">10</span>) <span class="keyword">unsigned</span>,</span><br><span class="line">                template_id <span class="built_in">int</span>(<span class="number">10</span>) <span class="keyword">unsigned</span>,</span><br><span class="line">                process_note MEDIUMINT,</span><br><span class="line">                process_status <span class="built_in">VARCHAR</span>(<span class="number">20</span>) <span class="keyword">DEFAULT</span> <span class="string">'unresolved'</span>,</span><br><span class="line">                PRIMARY <span class="keyword">KEY</span> (<span class="keyword">id</span>),</span><br><span class="line">                <span class="keyword">INDEX</span> (endpoint, strategy_id, template_id)</span><br><span class="line">)</span><br><span class="line">        <span class="keyword">ENGINE</span> =<span class="keyword">InnoDB</span></span><br><span class="line">        <span class="keyword">DEFAULT</span> <span class="keyword">CHARSET</span> =utf8;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">* 建立告警归档资料表, 存储各个告警触发状况的历史状态</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="keyword">DROP</span> <span class="keyword">TABLE</span> <span class="keyword">IF</span> <span class="keyword">EXISTS</span> <span class="keyword">events</span>;</span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> <span class="keyword">IF</span> <span class="keyword">NOT</span> <span class="keyword">EXISTS</span> <span class="keyword">events</span> (</span><br><span class="line">                <span class="keyword">id</span> MEDIUMINT <span class="keyword">NOT</span> <span class="literal">NULL</span> AUTO_INCREMENT,</span><br><span class="line">                event_caseId <span class="built_in">VARCHAR</span>(<span class="number">50</span>),</span><br><span class="line">                step <span class="built_in">int</span>(<span class="number">10</span>) <span class="keyword">unsigned</span>,</span><br><span class="line">                cond <span class="built_in">VARCHAR</span>(<span class="number">200</span>) <span class="keyword">NOT</span> <span class="literal">NULL</span>,</span><br><span class="line">                <span class="keyword">status</span> <span class="built_in">int</span>(<span class="number">3</span>) <span class="keyword">unsigned</span> <span class="keyword">DEFAULT</span> <span class="number">0</span>,</span><br><span class="line">                <span class="keyword">timestamp</span> <span class="keyword">Timestamp</span>,</span><br><span class="line">                PRIMARY <span class="keyword">KEY</span> (<span class="keyword">id</span>),</span><br><span class="line">                <span class="keyword">INDEX</span>(event_caseId),</span><br><span class="line">                FOREIGN <span class="keyword">KEY</span> (event_caseId) <span class="keyword">REFERENCES</span> event_cases(<span class="keyword">id</span>)</span><br><span class="line">                        <span class="keyword">ON</span> <span class="keyword">DELETE</span> <span class="keyword">CASCADE</span></span><br><span class="line">                        <span class="keyword">ON</span> <span class="keyword">UPDATE</span> <span class="keyword">CASCADE</span></span><br><span class="line">)</span><br><span class="line">        <span class="keyword">ENGINE</span> =<span class="keyword">InnoDB</span></span><br><span class="line">        <span class="keyword">DEFAULT</span> <span class="keyword">CHARSET</span> =utf8;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">* 告警留言表</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> <span class="keyword">IF</span> <span class="keyword">NOT</span> <span class="keyword">EXISTS</span> event_note (</span><br><span class="line">  <span class="keyword">id</span> MEDIUMINT <span class="keyword">NOT</span> <span class="literal">NULL</span> AUTO_INCREMENT,</span><br><span class="line">  event_caseId <span class="built_in">VARCHAR</span>(<span class="number">50</span>),</span><br><span class="line">  note    <span class="built_in">VARCHAR</span>(<span class="number">300</span>),</span><br><span class="line">  case_id <span class="built_in">VARCHAR</span>(<span class="number">20</span>),</span><br><span class="line">  <span class="keyword">status</span> <span class="built_in">VARCHAR</span>(<span class="number">15</span>),</span><br><span class="line">  <span class="keyword">timestamp</span> <span class="keyword">Timestamp</span>,</span><br><span class="line">  user_id <span class="built_in">int</span>(<span class="number">10</span>) <span class="keyword">unsigned</span>,</span><br><span class="line">  PRIMARY <span class="keyword">KEY</span> (<span class="keyword">id</span>),</span><br><span class="line">  <span class="keyword">INDEX</span> (event_caseId),</span><br><span class="line">  FOREIGN <span class="keyword">KEY</span> (event_caseId) <span class="keyword">REFERENCES</span> event_cases(<span class="keyword">id</span>)</span><br><span class="line">    <span class="keyword">ON</span> <span class="keyword">DELETE</span> <span class="keyword">CASCADE</span></span><br><span class="line">    <span class="keyword">ON</span> <span class="keyword">UPDATE</span> <span class="keyword">CASCADE</span>,</span><br><span class="line">  FOREIGN <span class="keyword">KEY</span> (user_id) <span class="keyword">REFERENCES</span> uic.user(<span class="keyword">id</span>)</span><br><span class="line">    <span class="keyword">ON</span> <span class="keyword">DELETE</span> <span class="keyword">CASCADE</span></span><br><span class="line">    <span class="keyword">ON</span> <span class="keyword">UPDATE</span> <span class="keyword">CASCADE</span></span><br><span class="line">);</span><br></pre></td></tr></table></figure><h1 id="常用比较重要的表"><a href="#常用比较重要的表" class="headerlink" title="常用比较重要的表"></a>常用比较重要的表</h1><ul><li>falcon_portal.strategy 报警规则表</li></ul><p>======================================================<br>希望各位朋友支持一下</p><ul><li>领取我的<a href="https://promotion.aliyun.com/ntms/act/ambassador/sharetouser.html?userCode=xpdsz87p&amp;utm_source=xpdsz87p" target="_blank" rel="noopener">阿里云幸运券</a>,谢谢.</li><li>使用<a href="https://cloud.tencent.com/redirect.php?redirect=1005&amp;cps_key=5a162632de40024cd01aabff4d3f1370" target="_blank" rel="noopener">腾讯云资源</a></li><li>自己的网站承接广告<a href="http://www.sudianlm.com/track/c/?rid=2056" target="_blank" rel="noopener">速点广告联盟</a></li><li>广告位招商QQ:1455975151</li><li>喜欢购物的朋友可以看看，<a href="http://www.1zhe.com/yq/1066027" target="_blank" rel="noopener">一折特卖</a><!--注册一折特卖，免费领集分宝，集分宝可以当钱花，免费购物不是梦，注册马上送你10集分宝。--></li></ul><p><strong>本文作者</strong>：dongsheng<br><strong>本文地址</strong>： <a href="https://mds1455975151.github.io/archives/75152a89.html">https://mds1455975151.github.io/archives/75152a89.html</a> <br><strong>版权声明</strong>：转载请注明出处！</p>]]></content>
    
    <summary type="html">
    
      Open-Falcon数据库表结构
    
    </summary>
    
      <category term="Linux运维" scheme="https://mds1455975151.github.io/categories/Linux%E8%BF%90%E7%BB%B4/"/>
    
    
      <category term="Open-Falcon" scheme="https://mds1455975151.github.io/tags/Open-Falcon/"/>
    
      <category term="表结构" scheme="https://mds1455975151.github.io/tags/%E8%A1%A8%E7%BB%93%E6%9E%84/"/>
    
  </entry>
  
  <entry>
    <title>Open-Falcon短信告警实现思路</title>
    <link href="https://mds1455975151.github.io/archives/634a8ea0.html"/>
    <id>https://mds1455975151.github.io/archives/634a8ea0.html</id>
    <published>2018-04-04T06:02:17.000Z</published>
    <updated>2018-04-04T06:44:06.886Z</updated>
    
    <content type="html"><![CDATA[<script src="\assets\js\APlayer.min.js"> </script><blockquote><p>Open-Falcon短信告警实现思路</p></blockquote><a id="more"></a><h1 id="概述"><a href="#概述" class="headerlink" title="概述"></a>概述</h1><p>监控系统产生报警事件之后需要发送报警短信，基本上都是利用各类短信提供商，falcon为了适配各个公司，在接入方案上做了一个规范，需要各公司提供http的短信发送接口。<br><strong>短信发送http接口：</strong><br><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">method:</span> <span class="string">post</span></span><br><span class="line"><span class="attr">params:</span></span><br><span class="line"><span class="attr">  - content:</span> <span class="string">短信内容</span></span><br><span class="line"><span class="attr">  - tos:</span> <span class="string">使用逗号分隔的多个手机号</span></span><br></pre></td></tr></table></figure></p><p>整个逻辑流程如下：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">报警信息-----&gt;封装http短信接口-------------------&gt;运营商短信接口-----------------&gt;发送短信给用户</span><br><span class="line">              method: post</span><br><span class="line">              params:                           参数1：短信内容</span><br><span class="line">                - content: 短信内容              参数2：发送人列表</span><br><span class="line">                - tos: 使用逗号分隔的多个手机号   其他参数：app,key,短信模板等等</span><br></pre></td></tr></table></figure></p><h1 id="部署实践"><a href="#部署实践" class="headerlink" title="部署实践"></a>部署实践</h1><blockquote><p>以腾讯云的短信作为运营商做说明</p></blockquote><h2 id="腾讯云sms服务调试流程"><a href="#腾讯云sms服务调试流程" class="headerlink" title="腾讯云sms服务调试流程"></a>腾讯云sms服务调试流程</h2><ul><li>注册腾讯云账号，开通腾讯云SMS服务</li><li>新建应用获取AppID及App Key完成后，创建签名及短信正文需要腾讯云审核通过才行</li><li>根据个人情况下载对应<a href="https://cloud.tencent.com/document/product/382/5804" target="_blank" rel="noopener">SDK包</a>，以Python为例进行讲解</li><li>安装Python SDK包，使用指定模板群发短信demon进行测试，不指定模板容易出现1014各类模板错误问题，最终结果保证短信发送成功</li></ul><h2 id="案例"><a href="#案例" class="headerlink" title="案例"></a>案例</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># pip install qcloudsms_py</span></span><br><span class="line"><span class="comment"># cat sendsms_id_m_version.py</span></span><br><span class="line"><span class="comment">#!/usr/bin/env python</span></span><br><span class="line"><span class="comment"># _*_ coding:utf-8 _*_</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"><span class="keyword">from</span> qcloudsms_py <span class="keyword">import</span> SmsMultiSender</span><br><span class="line"><span class="keyword">from</span> qcloudsms_py.httpclient <span class="keyword">import</span> HTTPError</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> len(sys.argv) != <span class="number">3</span>:</span><br><span class="line">    <span class="keyword">print</span> <span class="string">"Usages: python %s sms_to_userlist, sms_message"</span></span><br><span class="line">    exit(<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line">sms_to_userlist = sys.argv[<span class="number">1</span>]</span><br><span class="line">sms_message = sys.argv[<span class="number">2</span>]</span><br><span class="line">sms_to_userlist = sms_to_userlist.split(<span class="string">','</span>)</span><br><span class="line">sms_to_userlist = [ int(i) <span class="keyword">for</span> i <span class="keyword">in</span> sms_to_userlist ]</span><br><span class="line"></span><br><span class="line">appid=<span class="string">"xxx"</span></span><br><span class="line">appkey=<span class="string">"xxx"</span></span><br><span class="line">sms_sign=<span class="string">"xxx"</span></span><br><span class="line">phone_numbers = sms_to_userlist</span><br><span class="line">template_id = xxx</span><br><span class="line">sms_type = <span class="number">0</span></span><br><span class="line"></span><br><span class="line">msender = SmsMultiSender(appid, appkey)</span><br><span class="line">params = [<span class="string">"%s"</span> % sms_message]</span><br><span class="line"></span><br><span class="line"><span class="keyword">try</span>:</span><br><span class="line">    result = msender.send_with_param(<span class="number">86</span>, phone_numbers,</span><br><span class="line">        template_id, params, sign=sms_sign, extend=<span class="string">""</span>, ext=<span class="string">""</span>)</span><br><span class="line">    <span class="keyword">print</span> ok</span><br><span class="line"><span class="keyword">except</span> HTTPError <span class="keyword">as</span> e:</span><br><span class="line">    print(e)</span><br><span class="line"><span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">    print(e)</span><br><span class="line"></span><br><span class="line">print(result)</span><br><span class="line"><span class="comment"># python sendsms_id_m_version.py  # 测试发送结果</span></span><br><span class="line">&#123;<span class="string">u'ext'</span>: <span class="string">u''</span>, <span class="string">u'result'</span>: <span class="number">0</span>, <span class="string">u'errmsg'</span>: <span class="string">u'OK'</span>, <span class="string">u'detail'</span>: [&#123;<span class="string">u'fee'</span>: <span class="number">3</span>, <span class="string">u'mobile'</span>: <span class="string">u'13693645328'</span>, <span class="string">u'result'</span>: <span class="number">0</span>, <span class="string">u'sid'</span>: <span class="string">u'8:tNIvGUXyuK41wH8PFsV20180404'</span>, <span class="string">u'nationcode'</span>: <span class="string">u'86'</span>, <span class="string">u'errmsg'</span>: <span class="string">u'OK'</span>&#125;]&#125;</span><br></pre></td></tr></table></figure><blockquote><p>其中脚本里面的变量可以配置yaml格式的配置文件，动态读取配置项，可以更灵活</p></blockquote><h2 id="封装http短信接口思路"><a href="#封装http短信接口思路" class="headerlink" title="封装http短信接口思路"></a>封装http短信接口思路</h2><blockquote><p>将Open-Falcon post发送的content(短信内容)及tos(使用逗号分隔的多个手机号)提取到然后调用上一步的短信发送脚本即可</p></blockquote><h2 id="案例-1"><a href="#案例-1" class="headerlink" title="案例"></a>案例</h2><p>python or go<br>略</p><h1 id="参考资料"><a href="#参考资料" class="headerlink" title="参考资料"></a>参考资料</h1><p><a href="http://book.open-falcon.org/zh_0_2/distributed_install/mail-sms.html" target="_blank" rel="noopener">http://book.open-falcon.org/zh_0_2/distributed_install/mail-sms.html</a><br><a href="https://cloud.tencent.com/document/product/382" target="_blank" rel="noopener">https://cloud.tencent.com/document/product/382</a><br><a href="https://github.com/qcloudsms/qcloudsms_py/" target="_blank" rel="noopener">https://github.com/qcloudsms/qcloudsms_py/</a></p><p>======================================================<br>希望各位朋友支持一下</p><ul><li>领取我的<a href="https://promotion.aliyun.com/ntms/act/ambassador/sharetouser.html?userCode=xpdsz87p&amp;utm_source=xpdsz87p" target="_blank" rel="noopener">阿里云幸运券</a>,谢谢.</li><li>使用<a href="https://cloud.tencent.com/redirect.php?redirect=1005&amp;cps_key=5a162632de40024cd01aabff4d3f1370" target="_blank" rel="noopener">腾讯云资源</a></li><li>自己的网站承接广告<a href="http://www.sudianlm.com/track/c/?rid=2056" target="_blank" rel="noopener">速点广告联盟</a></li><li>广告位招商QQ:1455975151</li><li>喜欢购物的朋友可以看看，<a href="http://www.1zhe.com/yq/1066027" target="_blank" rel="noopener">一折特卖</a><!--注册一折特卖，免费领集分宝，集分宝可以当钱花，免费购物不是梦，注册马上送你10集分宝。--></li></ul><p><strong>本文作者</strong>：dongsheng<br><strong>本文地址</strong>： <a href="https://mds1455975151.github.io/archives/634a8ea0.html">https://mds1455975151.github.io/archives/634a8ea0.html</a> <br><strong>版权声明</strong>：转载请注明出处！</p>]]></content>
    
    <summary type="html">
    
      Open-Falcon短信告警实现思路
    
    </summary>
    
      <category term="Linux运维" scheme="https://mds1455975151.github.io/categories/Linux%E8%BF%90%E7%BB%B4/"/>
    
    
      <category term="Open-Falcon" scheme="https://mds1455975151.github.io/tags/Open-Falcon/"/>
    
      <category term="腾讯云SMS" scheme="https://mds1455975151.github.io/tags/%E8%85%BE%E8%AE%AF%E4%BA%91SMS/"/>
    
  </entry>
  
</feed>
